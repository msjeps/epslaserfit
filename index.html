<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laser Fit - Entraînement</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0a0a0a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Laser Fit">
    <link rel="icon" type="image/png" href="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/4gHYSUNDX1BST0ZJTEUAAQEAAAHIAAAAAAQwAABtbnRyUkdCIFhZWiAH4AABAAEAAAAAAABhY3NwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAA9tYAAQAAAADTLQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlkZXNjAAAA8AAAACRyWFlaAAABFAAAABRnWFlaAAABKAAAABRiWFlaAAABPAAAABR3dHB0AAABUAAAABRyVFJDAAABZAAAAChnVFJDAAABZAAAAChiVFJDAAABZAAAAChjcHJ0AAABjAAAADxtbHVjAAAAAAAAAAEAAAAMZW5VUwAAAAgAAAAcAHMAUgBHAEJYWVogAAAAAAAAb6IAADj1AAADkFhZWiAAAAAAAABimQAAt4UAABjaWFlaIAAAAAAAACSgAAAPhAAAts9YWVogAAAAAAAA9tYAAQAAAADTLXBhcmEAAAAAAAQAAAACZmYAAPKnAAANWQAAE9AAAApbAAAAAAAAAABtbHVjAAAAAAAAAAEAAAAMZW5VUwAAACAAAAAcAEcAbwBvAGcAbABlACAASQBuAGMALgAgADIAMAAxADb/2wBDAAUDBAQEAwUEBAQFBQUGBwwIBwcHBw8LCwkMEQ8SEhEPERETFhwXExQaFRERGCEYGh0dHx8fExciJCIeJBweHx7/2wBDAQUFBQcGBw4ICA4eFBEUHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh7/wAARCABkAGQDASIAAhEBAxEB/8QAHAABAAIDAQEBAAAAAAAAAAAAAAUGAwQHAgEI/8QANRAAAQMDAgQFAwMEAQUAAAAAAQIDBAAFEQYhEjFBYQcTIjJRFHGBI0KRCBUkUjNDYoKh4f/EABoBAAIDAQEAAAAAAAAAAAAAAAAEAQIDBQb/xAArEQABAwMDAwMEAwEAAAAAAAABAAIRAxIhBDFBUXGRE2HwIoGxwaHR4fH/2gAMAwEAAhEDEQA/AK1SlKIRSlKIRSlKIRSlKIRSlKIRSlKIRSlKkKEpSlEIpSlEIpSlEIpSlEIpSlEIpSlEIpSlEIpSlEIpSlEIpSlEIpSlEIpSlEIpSlEIpSlEIpSlEIpSlEIpSlEIpSlEIpSlEIpSlEIpSlEIpSlEIpSlEIpSlEIpSlEIpSlEIpSlEIpSlEIpSlEIpSlEIpSlEIpSlEIpSlEIpSlEIpSlEIpSlEIpSlEIpSlEIpSlEIpSlEIpSlEIpSlEIpSlEIpSlEIpSlEIpSlEIpSlEIpSlEIpSlEIpSlAp6n1Ld9BarfmuIClJUGnW06w8zniZX/uCMjfY1TqV69pRqUHclpBHIXEr0Hi+0nfccFKUrq4iUpSiEUpSiEUpRClKURYdPXh+yXZp9lJ8sqxIYzjjbI94HxVy0701JtWtW76xeW35rA8o8CSkJSoDeM4PTfr86rOn7s1YL/CuC3MRg5p9T6iU8PDsVfOOozXWL9PsWmLGl1aYkSXeEo+sVkBRzyHf9tfMdUqFvEtvXv8hdzR0KVYf1G5G2x78hU9Qua8EEz7Hny/K9WtDdTRxEhHXmY8cRwrVSteC4ZEOPIKPLLjaVcO++0wZ/NO20NqjLQMOuNkNqPHnffnjH3+9bFRxQvM/9FulrmGx29Z29Tv8+1p02lxlvMVhwg8qx0pStVBSlKIRSlKIRSlKIRSlKIRX6B0xbmLddYTUfhJZjuBS8fqYLSj+5X1J99cg0JZJ2p9Tw9PsF+LBfacfK1K4OFbZAQge+Rk/aua+VdS9KyxM7Cev8Li+E+HOqBq8ynK1mGCY48wDx28+nI/uJVwrj2u9czdTs/hR6GmDvKcYQVKT3/bX4/8Y+l+srP8AiocIH6ZvCokZH9IKzwj+xPT4r3YaA1/0P4MJv0VKrtZXEIfHgL4uFJ/1QVY/3FdEfQlgVz/wz8T9P+IWnmWYs+GPPSOEOG+hJ/1UeZO53+9cF8TDVqaWm6pSzBG3Yri7+yyWyypxlxCFDzZbnT7NJH/JT/8AQ1Zv6R/0xt2e/TdZXppSmFrCYbC+ioiT9xxHwKoWm9LXzWGrmtO2phVwmuuJwUt+pKP3qV0SOZ/8mv1XpPQtk0Tp2HY7TH4I8dGDxY4lk/zKz+aqTpPJdWPa0f3jcz6LS5OppChS/TvmTn09vpxMqn+DOibrZNPO6hurJiy7oW/LYdLYUhn/AGwT++v1+haSgNAI8hcpYlK1p3L2SQp3hQOJ1LJcON/cM43rdjusyGkuRnEuoWnIKDkK/BHOqNOkHCFYaklBhZKUrxegpSlEIpSlEIpSlEIpSlEIrmj/APU3c9N26TadT2UOSpykltUQH9U42VnohQ+ee1dLqn+K/hfb/Ezwye05cUpjTm1Ky6niLLqVDhcaV+1RP7vY5rZlVzCHMOClzGuEEZXCPhwB5LHhPpn+npCW4L0Iuh/yRwoO3Bn8V1RQ4mmlOoIUlpJWgn7Y4f8Aa/PtgTcrI87pC6xI8RrT8pT4u7ChxSUOZwVpUPV88q63YFRn4f67hA88pzxH8Zl4Wd5/jVhpf2eP5UnPqD22xL9DGm2WHsW23yJqAoAfXuISoA+3D17/AH5V+mrI1FgQ48NM1xbkZlLSXn3OMupCeJZOf3EgZ+9fmT+lC2u3jxJcgFrjYtrK33VL3aHEkBIP8RzV+9xzX7DhhCGgoN8XBAS2EFJ5ceOY+9Q5tOk/6QJ59/6U0q1So2S+YjOfHb+Vrz/zG1d6VaO5Vy0pSlc1dgpSlEIpSlEIpSlEIpSlEIr5X1Sfb1fC/KtPh/4x6f0H4b/irKnRnLyWo0PUlv4H21LcSoISQD6yR1GOYxzrXt1LoClK5t4PeL0jXNpuGmdURk/iTMdyS4gZUVgcKQqO5j4U3w58HpX5c+I8R/Regr1pqFHVUe5RljhWnBKFp/VQpSFJ5jfb7VisOSuikdfBKrPi/qcO6puOgYU5ci2W2OPMXgq89QJ/B/2Q2Tn+c1xxG1Xrx20lMvel7F4e2uC41Cv8VL0qU22VFpKuBCE5SPqF8SFBOexz0qjQLHOvWs7do9iJJjv3BdxYcW+2pBCWI5fSpKuY+pYT9q/QqYJPp4iub/Ky+pqjODAG/v3W3qCY9bYFpgT0uNpus7ymXUJX9O2psq448XEkg4znbHSupwvG/wAKYESO3DrqLbCYeW0qqzGaLqCpwqVv+rk9B7a3P6f7fBg+Dt1gW5bbTTa3ShtOSkckFRGACqQT/avztqfQdr0pYrW7YoN5RKm2xlyZZGkSXW4zThKBxpcceT/t7sEEfFRxBu+fOFo9lV/0NgxsJ9cTjz/i+gS8bV6x+q1vxP6w+q+0pSo4V7UpSiEUpSiEUpSiEUpSiE1kvVzl2i0z7lDtk2ezbYzy2Y0JsuIU71CB+R8cK+VfMT4e64v+u9Ew7VbdOTnbVOuLPmv+z+G+ykZOCeYTt+a8e3tHJgxd2c+P8FClqP1tN+KZcwg/sfnyS5cuH/1c7/XPl3NHwPivuXqf6pQRZJzL7gW4gfV21aVPoPwtDiktr+SjGa/RH0OorQv+kmuQ3C2yoqFoiyhGyshXCZEdhX/V1kqQr/VVXP8A/p+1Fc9ReFLK7l9YJ9ufctJfmBbqk/p8SXCo/tWOeO1Z1PpJ2kVaVevEgjhw/P5WLNBwYJhwn8P4hccjSZNq1jZVJmTZDU20y0EyJKXkgOqQQrLSGW1fOfUD0r9T2e+uTfDa2TJCXFSEWeGyW0MOLeUtTKAlOG0lpRUrhyR7c1+ab+dF6T1nYdZaT8PrXYpCFNuS0TYDKpCwlzbzFKJJwUYHSv0hp/TmrpbFs0JIhxbJFajxI95k/XNuNqcDbbSuyFBRSjp5Y+K3o1alCG1P27nMepjf/qodToVnNqsGDORtP3xC7eGN6aXZ+OfZ5MKWgBTMluOG2nkqGeCQjkk/NW2vJSCMEAjuOdf0/wBF1QVWEggic/ysMprHUpSiEUpSiEUpSiEUpSiEUpSiEUpSiEUpSiEUpSiEUpSiEUpSiE//2Q==">
    <link rel="apple-touch-icon" href="data:image/jpeg;base64,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">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Laser Fit">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary: #ff0066;
            --secondary: #00ffcc;
            --tertiary: #ffaa00;
            --bg-dark: #0a0a0a;
            --bg-card: #1a1a1a;
            --text: #ffffff;
            --text-dim: #cccccc;
            --success: #00ff88;
            --warning: #ffaa00;
            --danger: #ff3366;
        }
        
        /* Mode clair : surcharge uniquement le texte */
        body.light-mode {
            --text: #1a1a2e;
            --text-dim: #666666;
        }
        
        body {
            font-family: 'Rajdhani', sans-serif;
            background: var(--bg-dark);
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        @keyframes bgPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }
        
        .header {
            text-align: center;
            padding: 30px 20px;
            margin-bottom: 30px;
            background: linear-gradient(135deg, var(--bg-card) 0%, rgba(255, 0, 102, 0.1) 100%);
            border-radius: 20px;
            border: 2px solid rgba(255, 0, 102, 0.2);
            position: relative;
            overflow: hidden;
        }
        
        .settings-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(0, 255, 204, 0.2);
            border: 2px solid var(--secondary);
            color: var(--text);
            width: 45px;
            height: 45px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            z-index: 10;
        }
        
        .settings-btn:hover {
            background: var(--secondary);
            transform: rotate(90deg) scale(1.1);
            box-shadow: 0 0 20px rgba(0, 255, 204, 0.5);
        }
        
        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(10px);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .modal.hidden {
            display: none;
        }
        
        .modal-content {
            background: var(--bg-card);
            border: 2px solid rgba(0, 255, 204, 0.3);
            border-radius: 20px;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalSlideIn 0.3s ease;
        }
        
        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .modal-header {
            padding: 25px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h2 {
            margin: 0;
            font-size: 1.5rem;
            background: linear-gradient(135deg, var(--secondary), var(--primary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .close-btn {
            background: rgba(255, 0, 102, 0.2);
            border: 2px solid var(--primary);
            color: var(--primary);
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2rem;
            font-weight: 700;
            transition: all 0.3s ease;
        }
        
        .close-btn:hover {
            background: var(--primary);
            color: var(--bg-dark);
            transform: rotate(90deg);
        }
        
        .modal-body {
            padding: 25px;
        }
        
        .modal-footer {
            padding: 20px 25px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .settings-group {
            margin-bottom: 30px;
        }
        
        .settings-group:last-child {
            margin-bottom: 0;
        }
        
        .settings-group > label:first-child {
            display: block;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 15px;
        }
        
        .theme-selector {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        
        .theme-btn {
            background: rgba(255, 255, 255, 0.03);
            border: 2px solid rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }
        
        .theme-btn:hover {
            border-color: var(--secondary);
            transform: translateY(-2px);
        }
        
        .theme-btn.active {
            border-color: var(--secondary);
            background: rgba(0, 255, 204, 0.1);
            box-shadow: 0 0 20px rgba(0, 255, 204, 0.2);
        }
        
        .theme-preview {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 3px solid rgba(255, 255, 255, 0.2);
        }
        
        .theme-btn span {
            font-size: 0.9rem;
            color: var(--text);
            font-weight: 600;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent 30%, rgba(255, 0, 102, 0.1) 50%, transparent 70%);
            animation: shimmer 3s linear infinite;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }
        
        .header h1 {
            font-family: 'Orbitron', sans-serif;
            font-size: 3rem;
            font-weight: 900;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            position: relative;
            z-index: 1;
            letter-spacing: 3px;
            text-transform: uppercase;
        }
        
        .subtitle {
            font-size: 1.1rem;
            color: var(--text-dim);
            margin-top: 10px;
            position: relative;
            z-index: 1;
            font-weight: 600;
        }
        
        .card {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 20px;
            border: 2px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s ease;
        }
        
        .card-title {
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: 20px;
            color: var(--secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #ffffff;
            font-size: 1rem;
        }
        
        body.light-mode label {
            color: var(--text);
        }
        
        input[type="number"],
        input[type="text"],
        input[type="date"],
        input[type="time"],
        select {
            width: 100%;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid var(--secondary);
            border-radius: 10px;
            color: var(--text);
            font-size: 1rem;
            font-family: 'Rajdhani', sans-serif;
            transition: all 0.3s ease;
        }
        
        /* Inputs en mode clair : bordures bien visibles */
        body.light-mode input[type="number"],
        body.light-mode input[type="text"],
        body.light-mode input[type="date"],
        body.light-mode input[type="time"],
        body.light-mode select {
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid var(--secondary);
            color: var(--text);
        }
        
        input:focus,
        select:focus {
            outline: none;
            border-color: var(--primary);
            background: rgba(255, 0, 102, 0.1);
            box-shadow: 0 0 0 3px rgba(255, 0, 102, 0.1);
        }
        
        body.light-mode input:focus,
        body.light-mode select:focus {
            background: rgba(255, 255, 255, 1);
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0, 0, 0, 0.05);
        }
        
        /* Flèches de sélection number colorées */
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            opacity: 1;
            cursor: pointer;
        }
        
        /* Icônes calendrier/horloge colorées */
        input[type="date"]::-webkit-calendar-picker-indicator,
        input[type="time"]::-webkit-calendar-picker-indicator {
            cursor: pointer;
            filter: brightness(0) saturate(100%) invert(79%) sepia(52%) saturate(2846%) hue-rotate(127deg) brightness(101%) contrast(101%);
        }
        
        body.light-mode input[type="date"]::-webkit-calendar-picker-indicator,
        body.light-mode input[type="time"]::-webkit-calendar-picker-indicator {
            cursor: pointer;
            filter: brightness(0) saturate(100%) invert(39%) sepia(90%) saturate(1820%) hue-rotate(166deg) brightness(96%) contrast(101%);
        }
        
        /* Flèche de sélection (dropdown) colorée */
        select {
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%2300FFCC' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 20px 20px;
            padding-right: 40px;
        }
        
        body.light-mode select {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%23028090' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 20px 20px;
        }
        
        select option {
            background: var(--bg-card);
            color: var(--text);
        }
        
        .exercise-item {
            background: rgba(255, 255, 255, 0.03);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 12px;
            border-left: 4px solid var(--primary);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .exercise-name {
            font-weight: 600;
            font-size: 1.1rem;
        }
        
        .btn-move {
            background: rgba(0, 255, 204, 0.2);
            border: 1px solid var(--secondary);
            color: var(--secondary);
            padding: 4px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 700;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }
        
        .btn-move:hover:not(:disabled) {
            background: var(--secondary);
            color: var(--bg-dark);
            transform: scale(1.1);
        }
        
        .btn-move:disabled {
            cursor: not-allowed;
            border-color: var(--text-dim);
            color: var(--text-dim);
        }
        
        .exercise-delete {
            background: rgba(255, 51, 102, 0.2);
            border: none;
            color: var(--danger);
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .exercise-delete:hover {
            background: var(--danger);
            color: white;
        }
        
        .btn {
            padding: 14px 32px;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-family: 'Rajdhani', sans-serif;
            position: relative;
            overflow: hidden;
        }
        
        .btn span {
            position: relative;
            z-index: 1;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary), #cc0052);
            color: white;
            box-shadow: 0 4px 20px rgba(255, 0, 102, 0.3);
        }
        
        .btn-primary:hover {
            box-shadow: 0 6px 30px rgba(255, 0, 102, 0.5);
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, var(--secondary), #00cc99);
            color: var(--bg-dark);
            box-shadow: 0 4px 20px rgba(0, 255, 204, 0.3);
        }
        
        .btn-secondary:hover {
            box-shadow: 0 6px 30px rgba(0, 255, 204, 0.5);
            transform: translateY(-2px);
        }
        
        .btn-full {
            width: 100%;
            margin-top: 10px;
        }
        
        /* Bouton circulaire de démarrage */
        .circular-start-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 40px 0;
        }
        
        /* NOUVELLE BARRE START */
        .start-bar-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 30px 0;
            width: 100%;
            padding: 0 20px;
        }
        
        .btn-start-bar {
            width: 100%;
            max-width: 500px;
            height: 80px;
            background: linear-gradient(135deg, #FF006E 0%, #FF6B00 100%);
            border: none;
            border-radius: 15px;
            color: white;
            font-size: 1.8rem;
            font-weight: 900;
            letter-spacing: 2px;
            text-transform: uppercase;
            cursor: pointer;
            box-shadow: 0 8px 25px rgba(255, 0, 110, 0.4);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .btn-start-bar::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s;
        }
        
        .btn-start-bar:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(255, 0, 110, 0.6);
        }
        
        .btn-start-bar:hover::before {
            left: 100%;
        }
        
        .btn-start-bar:active {
            transform: translateY(0);
            box-shadow: 0 5px 15px rgba(255, 0, 110, 0.4);
        }
        
        .btn-start-bar:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-circular-start {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            border: none;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            box-shadow: 0 8px 30px rgba(255, 0, 102, 0.4);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
            padding: 20px;
            gap: 5px;
        }
        
        .btn-circular-start:hover {
            transform: scale(1.05);
            box-shadow: 0 12px 40px rgba(255, 0, 102, 0.6);
        }
        
        .btn-circular-start:active {
            transform: scale(0.98);
        }
        
        .btn-circular-start:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .circular-start-icon {
            width: 120px !important;
            height: 120px !important;
            min-width: 120px !important;
            min-height: 120px !important;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .circular-start-icon svg {
            width: 120px !important;
            height: 120px !important;
            display: block;
        }
        
        /* Triangle CSS pur - beaucoup plus gros */
        .triangle-play {
            width: 0;
            height: 0;
            border-left: 70px solid white;
            border-top: 40px solid transparent;
            border-bottom: 40px solid transparent;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.4));
            margin-left: 15px;
        }
        
        .circular-start-text {
            font-family: 'Orbitron', sans-serif;
            font-size: 3rem !important;
            font-weight: 900;
            color: white;
            letter-spacing: 3px;
            text-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
            margin-top: 0;
        }
        
        .circular-start-countdown {
            font-family: 'Orbitron', sans-serif;
            font-size: 5rem;
            font-weight: 900;
            color: white;
            text-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
            line-height: 1;
        }
        
        .circular-start-countdown-label {
            font-family: 'Rajdhani', sans-serif;
            font-size: 1.2rem;
            color: rgba(255, 255, 255, 0.9);
            margin-top: 10px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        
        /* Chronomètre intégré dans le bouton rond */
        .circular-start-timer {
            font-family: 'Orbitron', sans-serif;
            font-size: 3rem;
            font-weight: 900;
            color: white;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            line-height: 1;
            margin-bottom: 5px;
        }
        
        .circular-start-round {
            font-family: 'Rajdhani', sans-serif;
            font-size: 1rem;
            color: rgba(255, 255, 255, 0.8);
            letter-spacing: 1px;
        }
        
        /* Total Timer */
        .total-timer {
            background: linear-gradient(135deg, rgba(0, 255, 204, 0.1), rgba(255, 170, 0, 0.1));
            padding: 20px;
            border-radius: 16px;
            margin-bottom: 20px;
            border: 2px solid rgba(0, 255, 204, 0.3);
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .total-timer.waiting {
            background: linear-gradient(135deg, rgba(136, 136, 136, 0.1), rgba(170, 170, 170, 0.1));
            border-color: rgba(136, 136, 136, 0.3);
        }
        
        .total-timer-label {
            font-size: 1rem;
            color: var(--text-dim);
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .total-timer-display {
            font-family: 'Orbitron', sans-serif;
            font-size: 2.5rem;
            font-weight: 900;
            color: var(--secondary);
        }
        
        .total-timer.waiting .total-timer-display {
            color: var(--text-dim);
        }
        
        /* Recap styles */
        .recap-info {
            background: rgba(0, 255, 204, 0.05);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            border: 2px solid rgba(0, 255, 204, 0.2);
        }
        
        .recap-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .recap-item:last-child {
            border-bottom: none;
        }
        
        .recap-label {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text);
        }
        
        .recap-value {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--secondary);
        }
        
        .sequence-list {
            margin-top: 20px;
        }
        
        .sequence-item {
            background: rgba(255, 255, 255, 0.03);
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
            border-left: 4px solid var(--primary);
            transition: all 0.3s ease;
        }
        
        .sequence-item:hover {
            background: rgba(255, 0, 102, 0.1);
            transform: translateX(5px);
        }
        
        .sequence-item.shooting {
            border-left-color: var(--tertiary);
        }
        
        .sequence-number {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.2rem;
            font-weight: 900;
            color: var(--text-dim);
            min-width: 40px;
            text-align: center;
        }
        
        .sequence-name {
            flex: 1;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text);
        }
        
        .sequence-duration {
            font-size: 0.95rem;
            color: var(--text-dim);
            font-weight: 600;
        }
        
        /* Tabata */
        .tabata-container {
            background: var(--bg-card);
            padding: 30px;
            border-radius: 16px;
            margin-bottom: 30px;
            border: 2px solid rgba(255, 255, 255, 0.05);
            text-align: center;
        }
        
        .tabata-phase {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 15px;
            padding: 10px 20px;
            border-radius: 10px;
            display: inline-block;
        }
        
        .tabata-phase.work {
            background: rgba(0, 255, 204, 0.2);
            color: var(--secondary);
            border: 2px solid var(--secondary);
        }
        
        .tabata-phase.rest {
            background: rgba(255, 170, 0, 0.2);
            color: var(--tertiary);
            border: 2px solid var(--tertiary);
        }
        
        /* Chrono circulaire */
        .tabata-circle {
            width: 140px;
            height: 140px;
            border-radius: 50%;
            background: linear-gradient(135deg, rgba(0, 255, 204, 0.15), rgba(255, 170, 0, 0.15));
            border: 3px solid var(--secondary);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            box-shadow: 0 0 20px rgba(0, 255, 204, 0.3);
            transition: all 0.3s ease;
            flex-shrink: 0;
        }
        
        .tabata-phase-circle {
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--success);
            margin-bottom: 5px;
        }
        
        .timer-display-circle {
            font-family: 'Orbitron', sans-serif;
            font-size: 2.5rem;
            font-weight: 900;
            color: var(--secondary);
            text-align: center;
            line-height: 1;
        }
        
        .timer-display-circle.warning {
            animation: pulse-circle 0.5s ease-in-out infinite;
            color: var(--primary);
        }
        
        @keyframes pulse-circle {
            0%, 100% {
                transform: scale(1);
                text-shadow: 0 0 10px rgba(255, 0, 102, 0.5);
            }
            50% {
                transform: scale(1.1);
                text-shadow: 0 0 20px rgba(255, 0, 102, 0.8);
            }
        }
        
        .exercise-info {
            text-align: center;
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 30px;
        }
        
        .current-exercise {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 10px;
            text-transform: uppercase;
        }
        
        .exercise-number {
            font-size: 1.2rem;
            color: var(--text-dim);
            font-weight: 600;
        }
        
        .timer-display {
            font-family: 'Orbitron', sans-serif;
            font-size: 8rem;
            font-weight: 900;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 40px 0;
            animation: timerPulse 1s ease-in-out infinite;
        }
        
        @keyframes timerPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .timer-display.warning {
            background: linear-gradient(135deg, var(--warning), var(--danger));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: timerWarning 0.5s ease-in-out infinite;
        }
        
        @keyframes timerWarning {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .counter-section {
            background: var(--bg-card);
            padding: 30px;
            border-radius: 16px;
            margin-bottom: 30px;
            border: 2px solid rgba(255, 255, 255, 0.05);
        }
        
        .counter-label {
            font-size: 1.3rem;
            color: var(--text-dim);
            margin-bottom: 15px;
            font-weight: 600;
            text-align: center;
        }
        
        .counter-display {
            font-family: 'Orbitron', sans-serif;
            font-size: 5rem;
            font-weight: 900;
            color: var(--secondary);
            margin: 20px 0;
            text-align: center;
        }
        
        .counter-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .btn-counter {
            padding: 16px 40px;
            font-size: 1.3rem;
            min-width: 120px;
        }
        
        .btn-counter:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            filter: grayscale(50%);
        }
        
        /* Points display */
        .points-display {
            margin-top: 25px;
            padding: 20px;
            background: linear-gradient(135deg, rgba(0, 255, 204, 0.1), rgba(255, 170, 0, 0.1));
            border-radius: 12px;
            border: 2px solid rgba(0, 255, 204, 0.3);
            text-align: center;
        }
        
        .points-label {
            display: block;
            font-size: 1.1rem;
            color: var(--text-dim);
            margin-bottom: 8px;
            font-weight: 600;
        }
        
        .points-value {
            font-family: 'Orbitron', sans-serif;
            font-size: 2.5rem;
            font-weight: 900;
            background: linear-gradient(135deg, var(--secondary), var(--tertiary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        /* Version petite pour affichage en bas */
        .points-display-small {
            background: rgba(0, 255, 204, 0.05);
            padding: 8px 12px;
            border-radius: 8px;
            margin-top: 15px;
            text-align: center;
        }
        
        .points-label-small {
            font-size: 0.85rem;
            color: var(--text-dim);
            font-weight: 600;
        }
        
        .points-value-small {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--secondary);
            margin-left: 5px;
        }
        
        /* Toggle Switch */
        .toggle-container {
            position: relative;
            width: 50px;
            height: 26px;
            flex-shrink: 0;
        }
        
        .toggle-input {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
            z-index: 2;
            margin: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255, 255, 255, 0.1);
            border: 2px solid var(--secondary);
            transition: 0.4s;
            border-radius: 34px;
            pointer-events: none;
        }
        
        /* Toggle en mode clair : bordure colorée selon le thème */
        body.light-mode .toggle-slider {
            background-color: rgba(255, 255, 255, 0.8);
            border: 2px solid var(--secondary);
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 2px;
            bottom: 2px;
            background-color: #888888;
            transition: 0.4s;
            border-radius: 50%;
        }
        
        body.light-mode .toggle-slider:before {
            background-color: #666666;
        }
        
        /* Toggle activé (checked) */
        .toggle-input:checked + .toggle-slider {
            background-color: var(--secondary);
            border-color: var(--secondary);
        }
        
        body.light-mode .toggle-input:checked + .toggle-slider {
            background-color: var(--secondary);
            border-color: var(--secondary);
        }
        
        .toggle-input:checked + .toggle-slider:before {
            background-color: #ffffff;
            transform: translateX(24px);
        }
        
        body.light-mode .toggle-input:checked + .toggle-slider:before {
            background-color: #ffffff;
            transform: translateX(24px);
        }
        
        /* Bouton réglages */
        .settings-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border: 2px solid var(--secondary);
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            z-index: 1000;
            box-shadow: 0 4px 15px rgba(0, 255, 204, 0.3);
            transition: all 0.3s ease;
        }
        
        .settings-btn:hover {
            transform: rotate(90deg) scale(1.1);
            box-shadow: 0 6px 20px rgba(0, 255, 204, 0.5);
        }
        
        /* Panneau de réglages */
        .settings-panel {
            position: fixed;
            top: 0;
            right: 0;
            width: 350px;
            height: 100vh;
            background: var(--bg-card);
            border-left: 2px solid var(--secondary);
            box-shadow: -5px 0 20px rgba(0, 0, 0, 0.5);
            z-index: 999;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            overflow-y: auto;
        }
        
        .settings-panel:not(.hidden) {
            transform: translateX(0);
        }
        
        .settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background: linear-gradient(135deg, rgba(0, 255, 204, 0.1), rgba(255, 170, 0, 0.1));
            border-bottom: 2px solid var(--secondary);
        }
        
        .settings-header h3 {
            margin: 0;
            color: var(--secondary);
            font-size: 1.5rem;
        }
        
        .close-btn {
            background: none;
            border: none;
            color: var(--text);
            font-size: 1.5rem;
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            transition: all 0.3s ease;
        }
        
        .close-btn:hover {
            background: rgba(255, 0, 102, 0.2);
            color: var(--primary);
            transform: rotate(90deg);
        }
        
        .settings-content {
            padding: 20px;
        }
        
        .setting-item {
            background: rgba(255, 255, 255, 0.03);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 20px;
        }
        
        .setting-label {
            flex: 1;
        }
        
        .setting-label span {
            display: block;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 5px;
        }
        
        .setting-label small {
            display: block;
            font-size: 0.85rem;
            color: #cccccc;
            line-height: 1.4;
        }
        
        body.light-mode .setting-label small {
            color: #666666;
        }
        
        .theme-select {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid var(--secondary);
            border-radius: 8px;
            color: var(--text);
            padding: 10px 15px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            min-width: 150px;
        }
        
        .theme-select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 10px rgba(0, 255, 204, 0.3);
        }
        
        .theme-select option {
            background: var(--bg-dark);
            color: var(--text);
        }
        
        .instructions {
            background: rgba(255, 170, 0, 0.05);
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
            border-left: 4px solid var(--tertiary);
        }
        
        .instructions-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--tertiary);
            margin-bottom: 10px;
        }
        
        .instructions-text {
            color: var(--text-dim);
            line-height: 1.6;
            font-size: 0.95rem;
        }
        
        /* Results */
        .total-score {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            padding: 50px;
            border-radius: 20px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .score-label {
            font-size: 1.5rem;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 10px;
        }
        
        .score-value {
            font-family: 'Orbitron', sans-serif;
            font-size: 6rem;
            font-weight: 900;
            color: white;
        }
        
        .breakdown-item {
            display: flex;
            justify-content: space-between;
            padding: 15px;
            margin-bottom: 10px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            border-left: 4px solid var(--primary);
        }
        
        .breakdown-exercise {
            font-weight: 600;
            font-size: 1.1rem;
        }
        
        .breakdown-score {
            font-weight: 700;
            color: var(--secondary);
            font-size: 1.2rem;
        }
        
        .hidden {
            display: none !important;
        }
        
        /* Badges */
        .badge-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            border: 2px solid var(--secondary);
            min-width: 100px;
            animation: badgeAppear 0.5s ease;
        }
        
        @keyframes badgeAppear {
            from {
                opacity: 0;
                transform: scale(0.5) rotate(-10deg);
            }
            to {
                opacity: 1;
                transform: scale(1) rotate(0deg);
            }
        }
        
        .badge-icon {
            font-size: 3rem;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.3));
        }
        
        .badge-name {
            font-size: 0.9rem;
            font-weight: 700;
            color: var(--text);
            text-align: center;
        }
        
        .badge-desc {
            font-size: 0.75rem;
            color: var(--text-dim);
            text-align: center;
        }
        
        /* Mode Selector */
        .mode-selector {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 30px 0;
        }
        
        .mode-option {
            padding: 30px 20px;
            background: rgba(255, 255, 255, 0.03);
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .mode-option:hover {
            border-color: var(--secondary);
            background: rgba(0, 255, 204, 0.1);
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 255, 204, 0.3);
        }
        
        .mode-icon {
            font-size: 4rem;
            margin-bottom: 15px;
        }
        
        .mode-name {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 10px;
        }
        
        .mode-desc {
            font-size: 0.9rem;
            color: var(--text-dim);
        }
        
        /* Team Setup */
        .team-card {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 5px solid;
        }
        
        .team-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .team-name {
            font-size: 1.2rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .team-member {
            background: rgba(255, 255, 255, 0.05);
            padding: 10px 15px;
            border-radius: 8px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .team-member-name {
            font-weight: 600;
            color: var(--text);
        }
        
        .team-progress {
            width: 100%;
            height: 30px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .team-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 0.9rem;
        }
        
        .team-score-display {
            font-size: 2rem;
            font-weight: 900;
            color: var(--secondary);
            text-align: center;
        }
        
        .podium {
            display: flex;
            justify-content: center;
            align-items: flex-end;
            gap: 20px;
            margin: 40px 0;
        }
        
        .podium-place {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }
        
        .podium-place.first {
            order: 2;
        }
        
        .podium-place.second {
            order: 1;
        }
        
        .podium-place.third {
            order: 3;
        }
        
        .podium-medal {
            font-size: 4rem;
        }
        
        .podium-team {
            font-size: 1.3rem;
            font-weight: 700;
        }
        
        .podium-score {
            font-size: 2rem;
            font-weight: 900;
            color: var(--secondary);
        }
        
        .podium-block {
            width: 120px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 10px 10px 0 0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 900;
            font-size: 1.5rem;
        }
        
        .podium-place.first .podium-block {
            height: 150px;
        }
        
        .podium-place.second .podium-block {
            height: 100px;
        }
        
        .podium-place.third .podium-block {
            height: 70px;
        }
        
        @media (max-width: 600px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .timer-display {
                font-size: 5rem;
            }
            
            .counter-display {
                font-size: 3.5rem;
            }
            
            .score-value {
                font-size: 4rem;
            }
        }
    </style>
    <script src="qrcode.min.js"></script>
</head>
<body>
    <button class="settings-btn" onclick="toggleSettings()">⚙️</button>
    
    <!-- Menu réglages -->
    <div id="settingsPanel" class="settings-panel hidden">
        <div class="settings-header">
            <h3>⚙️ Réglages</h3>
            <button class="close-btn" onclick="toggleSettings()">✕</button>
        </div>
        
        <div class="settings-content">
            <div class="setting-item">
                <div class="setting-label">
                    <span>🔊 Bips sonores</span>
                    <small>Émet un bip au début et à la fin de chaque exercice</small>
                </div>
                <div class="toggle-container">
                    <input type="checkbox" id="soundToggleSettings" class="toggle-input" checked onchange="updateSoundSetting()">
                    <div class="toggle-slider"></div>
                </div>
            </div>
            
            <div class="setting-item">
                <div class="setting-label">
                    <span>🌓 Mode sombre</span>
                    <small>Activer le thème sombre pour réduire la fatigue visuelle</small>
                </div>
                <div class="toggle-container">
                    <input type="checkbox" id="darkModeToggle" class="toggle-input" checked onchange="toggleDarkMode()">
                    <div class="toggle-slider"></div>
                </div>
            </div>
            
            <div class="setting-item">
                <div class="setting-label">
                    <span>🕐 Date/Heure automatique</span>
                    <small>Actualiser automatiquement la date et l'heure à chaque séance</small>
                </div>
                <div class="toggle-container">
                    <input type="checkbox" id="autoDateTimeToggle" class="toggle-input" checked onchange="toggleAutoDateTime()">
                    <div class="toggle-slider"></div>
                </div>
            </div>
            
            <div class="setting-item">
                <div class="setting-label">
                    <span>🎨 Thème de couleur</span>
                    <small>Choisir le style visuel de l'interface</small>
                </div>
                <select id="themeSelector" class="theme-select" onchange="changeTheme()">
                    <option value="cyan">Cyan</option>
                    <option value="purple">Violet</option>
                    <option value="green">Vert</option>
                    <option value="orange">Orange</option>
                    <option value="blue">Bleu</option>
                    <option value="white">Blanc</option>
                </select>
            </div>
        </div>
    </div>
    
    <div class="container">
        <div class="header">
            <h1>⚡ Laser Fit ⚡</h1>
            <div class="subtitle">Fitness + Tir Laser de Précision</div>
            <button class="settings-btn" onclick="openSettings()" title="Réglages">
                <span>⚙️</span>
            </button>
        </div>

        <!-- Modal Réglages -->
        <div id="settingsModal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>⚙️ Réglages</h2>
                    <button class="close-btn" onclick="closeSettings()">✕</button>
                </div>
                
                <div class="modal-body">
                    <div class="settings-group">
                        <label style="display: flex; align-items: center; justify-content: space-between; cursor: pointer;" onclick="toggleSoundSetting()">
                            <span>🔊 Bips sonores</span>
                            <div class="toggle-container">
                                <input type="checkbox" id="soundToggleSettings" class="toggle-input" checked onclick="event.stopPropagation()">
                                <div class="toggle-slider"></div>
                            </div>
                        </label>
                        <small style="color: var(--text-dim); font-size: 0.85rem; margin-top: 5px; display: block;">
                            Émet un bip au lancement et à la fin de chaque exercice
                        </small>
                    </div>
                    
                    <div class="settings-group">
                        <label>🎨 Thème de couleur</label>
                        <div class="theme-selector">
                            <button class="theme-btn active" data-theme="cyan" onclick="changeTheme('cyan')">
                                <div class="theme-preview" style="background: linear-gradient(135deg, #00FFCC, #FF0066);"></div>
                                <span>Cyan/Rose</span>
                            </button>
                            <button class="theme-btn" data-theme="blue" onclick="changeTheme('blue')">
                                <div class="theme-preview" style="background: linear-gradient(135deg, #0099FF, #FF6600);"></div>
                                <span>Bleu/Orange</span>
                            </button>
                            <button class="theme-btn" data-theme="purple" onclick="changeTheme('purple')">
                                <div class="theme-preview" style="background: linear-gradient(135deg, #CC00FF, #FFCC00);"></div>
                                <span>Violet/Jaune</span>
                            </button>
                            <button class="theme-btn" data-theme="green" onclick="changeTheme('green')">
                                <div class="theme-preview" style="background: linear-gradient(135deg, #00FF88, #FF0088);"></div>
                                <span>Vert/Rose</span>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="modal-footer">
                    <button class="btn btn-primary btn-full" onclick="closeSettings()">
                        <span>Fermer</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Mode Selection Screen (FIRST) -->
        <div id="initialModeScreen">
            <div class="card">
                <div class="logo-container" style="text-align: center; margin-bottom: 30px;">
                    <img src="data:image/jpeg;base64,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" alt="Laser Fit" style="width: 100px; height: 100px; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.2);">
                    <h1 style="margin-top: 20px; font-size: 2.5rem; background: linear-gradient(135deg, var(--primary), var(--secondary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">Laser Fit</h1>
                    <p style="color: var(--text-dim); margin-top: 10px;">Collège Mont Saint Jean</p>
                </div>
                
                <h2 class="card-title">🎮 Choisir le mode d'activité</h2>
                
                <div class="mode-selector">
                    <div class="mode-option" onclick="selectInitialMode('solo')">
                        <div class="mode-icon">👤</div>
                        <div class="mode-name">Mode Solo</div>
                        <div class="mode-desc">Séance individuelle classique</div>
                    </div>
                    
                    <div class="mode-option" onclick="selectInitialMode('team')">
                        <div class="mode-icon">👥</div>
                        <div class="mode-name">Mode Équipe</div>
                        <div class="mode-desc">Relais par équipes avec score collectif</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Info Screen -->
        <div id="infoScreen" class="hidden">
            <div class="card">
                <h2 class="card-title">👥 Informations de la séance</h2>
                
                <div class="form-group">
                    <label for="studentName">Nom du pratiquant</label>
                    <input type="text" id="studentName" placeholder="Prénom et nom" autocomplete="off">
                </div>
                
                <div class="form-group">
                    <label for="observerName">Nom de l'observateur/coach</label>
                    <input type="text" id="observerName" placeholder="Prénom et nom" autocomplete="off">
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div class="form-group" style="margin-bottom: 0;">
                        <label for="className">Classe</label>
                        <input type="text" id="className" placeholder="Ex: 3ème A" autocomplete="off">
                    </div>
                    
                    <div class="form-group" style="margin-bottom: 0;">
                        <label for="groupName">Groupe</label>
                        <input type="text" id="groupName" placeholder="Ex: Groupe 1" autocomplete="off">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Date et Heure</label>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <input type="date" id="sessionDate" disabled>
                        <input type="time" id="sessionTime" disabled>
                    </div>
                </div>
                
                <button class="btn btn-primary btn-full" onclick="goToModeSelection()">
                    <span>Suivant ➡️</span>
                </button>
            </div>
        </div>

        <!-- Team Setup Screen -->
        <div id="teamSetupScreen" class="hidden">
            <div class="card">
                <h2 class="card-title">⚙️ Configuration des équipes</h2>
                
                <div class="form-group">
                    <label>Nombre d'équipes</label>
                    <div style="display: flex; gap: 10px; justify-content: center; margin-top: 10px;">
                        <button class="btn btn-secondary" onclick="setTeamCount(1)" id="teamCount1" style="min-width: 60px;">1</button>
                        <button class="btn btn-secondary" onclick="setTeamCount(2)" id="teamCount2" style="min-width: 60px;">2</button>
                        <button class="btn btn-secondary" onclick="setTeamCount(3)" id="teamCount3" style="min-width: 60px;">3</button>
                        <button class="btn btn-secondary" onclick="setTeamCount(4)" id="teamCount4" style="min-width: 60px;">4</button>
                    </div>
                    <div style="margin-top: 15px; padding: 15px; background: rgba(0, 255, 204, 0.1); border-radius: 8px; border-left: 4px solid var(--secondary);">
                        <p style="font-size: 0.95rem; color: var(--text); margin: 0; line-height: 1.5;">
                            💡 <strong>Mode multi-tablettes (1 équipe) :</strong><br>
                            Chaque équipe utilise sa propre tablette avec un observateur dédié.<br>
                            Toutes les équipes courent <strong>en même temps</strong> → Gain de temps considérable !<br>
                            Comparez ensuite les CSV pour déterminer l'équipe gagnante. 🏆
                        </p>
                    </div>
                </div>
                
                <div id="teamsContainer" style="margin-top: 30px;"></div>
                
                <button class="btn btn-primary btn-full" onclick="startTeamSession()" style="margin-top: 20px;">
                    <span>🚀 Démarrer le relais</span>
                </button>
                
                <button class="btn btn-secondary btn-full" onclick="backToModeSelection()" style="margin-top: 10px;">
                    <span>⬅️ Retour</span>
                </button>
            </div>
        </div>

        <!-- Team Relay Screen -->
        <div id="teamRelayScreen" class="hidden">
            <div class="card">
                <h2 class="card-title">🏃 Relais en cours</h2>
                
                <div id="teamScoreboard" style="margin-bottom: 30px;"></div>
                
                <div class="card" style="background: rgba(0, 255, 204, 0.1); border: 2px solid var(--secondary);">
                    <h3 style="color: var(--secondary); margin-bottom: 15px;">🏃 Coureur actuel</h3>
                    <div id="currentRunner" style="font-size: 1.3rem; font-weight: 700; text-align: center; margin-bottom: 20px;"></div>
                    <button class="btn btn-primary btn-full" onclick="startCurrentRunner()">
                        <span>▶️ Lancer la séance</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Config Screen -->
        <div id="configScreen" class="hidden">
            <div class="card">
                <h2 class="card-title">📋 Configuration de la séance</h2>
                
                <div class="form-group">
                    <label for="numExercises">Nombre d'exercices à effectuer</label>
                    <input type="number" id="numExercises" min="1" max="20" value="4" onchange="updateExerciseList()">
                </div>
                
                <div class="form-group">
                    <label for="numShootingSessions">Nombre de sessions de tirs</label>
                    <input type="number" id="numShootingSessions" min="0" max="5" value="1" onchange="updateExerciseList()">
                </div>
                
                <div class="form-group">
                    <label for="exerciseTime">Temps d'exercice et de tir (secondes)</label>
                    <input type="number" id="exerciseTime" min="10" max="120" value="45">
                </div>
                
                <div class="form-group">
                    <label for="pauseTime">Temps de pause entre ateliers (secondes)</label>
                    <input type="number" id="pauseTime" min="5" max="60" value="15">
                </div>
                
                <div class="form-group">
                    <label>Exercices à exécuter</label>
                    <select id="exerciseSelector">
                        <option value="">-- Choisir un exercice --</option>
                        <option value="SAUT À LA CORDE">SAUT À LA CORDE</option>
                        <option value="JUMPING JACK">JUMPING JACK</option>
                        <option value="1/2 BURPEES">1/2 BURPEES</option>
                        <option value="STEP UP">STEP UP (montée contre-haut)</option>
                        <option value="POMPES INCLINÉES">POMPES INCLINÉES</option>
                        <option value="ALLER RETOURS">ALLER RETOURS (largeur terrain volley)</option>
                        <option value="SAUTS LATÉRAUX">SAUTS LATÉRAUX</option>
                        <option value="SAUTS GROUPÉS">SAUTS GROUPÉS (kangourou)</option>
                        <option value="MONTÉES DE GENOUX">MONTÉES DE GENOUX (skipping)</option>
                        <option value="SQUATS">SQUATS (flexions jambes)</option>
                        <option value="MOUNTAIN CLIMBERS">MOUNTAIN CLIMBERS</option>
                        <option value="PLANCHE MILITAIRE">PLANCHE MILITAIRE (planche commando)</option>
                        <option value="FENTES AVANT">FENTES AVANT</option>
                        <option value="FENTES LATÉRALES">FENTES LATÉRALES</option>
                    </select>
                </div>
                
                <div id="exerciseList"></div>
                
                <button class="btn btn-primary btn-full" onclick="startSession()">
                    <span>🚀 Démarrer la séance</span>
                </button>
            </div>
        </div>

        <!-- Session Screen -->
        <div id="sessionScreen" class="hidden">
            <!-- Récapitulatif avant démarrage -->
            <div id="recapSection">
                <div class="card">
                    <h2 class="card-title">📋 Récapitulatif de la séance</h2>
                    
                    <div class="recap-info">
                        <div class="recap-item">
                            <span class="recap-label">⏱️ Temps total estimé :</span>
                            <span class="recap-value" id="totalEstimatedTime">0:00</span>
                        </div>
                        <div class="recap-item">
                            <span class="recap-label">🏋️ Nombre d'ateliers :</span>
                            <span class="recap-value" id="totalAteliers">0</span>
                        </div>
                    </div>
                    
                    <div class="sequence-list" id="sequenceRecap"></div>
                </div>
                
                <button class="btn btn-primary btn-full" id="startGlobalButton" onclick="startGlobalSession()" style="margin-top: 20px;">
                    <span>▶️ DÉMARRER LA SÉANCE</span>
                </button>
                
                <button class="btn btn-secondary btn-full" onclick="backToConfig()" style="margin-top: 10px;">
                    <span>⬅️ Retour à la configuration</span>
                </button>
            </div>
            
            <!-- Session en cours (initialement caché) -->
            <div id="sessionInProgress" class="hidden">
            
            <div class="total-timer waiting hidden" id="totalTimerContainer">
                <div class="total-timer-label">⏱️ Temps total</div>
                <div class="total-timer-display" id="totalTimeDisplay">00:00</div>
            </div>
            
            <div class="start-bar-container">
                <button class="btn-start-bar" id="startTabataButton" onclick="startTabata()">
                    DÉMARRER L'ÉPREUVE
                </button>
            </div>
            
            <div class="exercise-info">
                <div class="current-exercise" id="currentAtelierName"></div>
                <div class="exercise-number" id="atelierProgress"></div>
            </div>
            
            <div id="atelierInstructions" class="instructions"></div>
            
            <div class="counter-section" id="repSection">
                <div class="counter-label">Nombre de répétitions</div>
                
                <div style="display: flex; align-items: center; gap: 40px; justify-content: center; margin: 30px 0;">
                    <!-- Compteur et boutons à gauche -->
                    <div style="display: flex; flex-direction: column; align-items: center; gap: 15px;">
                        <div class="counter-display" id="repCounter">0</div>
                        <div class="counter-buttons">
                            <button class="btn btn-secondary btn-counter" onclick="decrementReps()">
                                <span>-1</span>
                            </button>
                            <button class="btn btn-primary btn-counter" onclick="incrementReps()">
                                <span>+1</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Chrono circulaire à droite -->
                    <div class="tabata-circle">
                        <div class="tabata-phase-circle" id="tabataPhase">EXERCICE</div>
                        <div id="tabataDisplay" class="timer-display-circle">45</div>
                    </div>
                </div>
                
                <div class="points-display-small" id="pointsDisplay">
                    <span class="points-label-small">Points : </span>
                    <span class="points-value-small" id="currentPoints">0 pts</span>
                </div>
            </div>
            
            <div class="counter-section hidden" id="shootingSection">
                <div class="form-group" style="margin-bottom: 20px;">
                    <div class="instructions-title">
                        🎯 Choix de la distance de tir
                    </div>
                    <select id="shootingDistance" onchange="updateShootingPoints()">
                        <option value="3">3 mètres</option>
                        <option value="5">5 mètres</option>
                        <option value="8">8 mètres</option>
                    </select>
                </div>
                <div class="counter-label">Tirs réussis</div>
                
                <div style="display: flex; align-items: center; gap: 40px; justify-content: center; margin: 30px 0;">
                    <!-- Compteur et boutons à gauche -->
                    <div style="display: flex; flex-direction: column; align-items: center; gap: 15px;">
                        <div class="counter-display" id="hitsCounter">0</div>
                        <div class="counter-buttons">
                            <button class="btn btn-secondary btn-counter" onclick="decrementHits()">
                                <span>-1</span>
                            </button>
                            <button class="btn btn-primary btn-counter" onclick="incrementHits()">
                                <span>+1</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Chrono circulaire à droite -->
                    <div class="tabata-circle">
                        <div class="tabata-phase-circle" id="tabataPhase2">EXERCICE</div>
                        <div id="tabataDisplay2" class="timer-display-circle">45</div>
                    </div>
                </div>
                
                <div class="points-display-small" id="shootingPointsDisplay">
                    <span class="points-label-small">Points : </span>
                    <span class="points-value-small" id="currentShootingPoints">0 pts</span>
                </div>
            </div>
            
            </div><!-- Fin sessionInProgress -->
        </div><!-- Fin sessionScreen -->

        <!-- Results Screen -->
        <div id="resultsScreen" class="hidden">
            <div class="card" style="margin-bottom: 20px;">
                <h3 class="card-title" style="font-size: 1.2rem; margin-bottom: 15px;">📋 Informations</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; font-size: 0.95rem;">
                    <div>
                        <strong style="color: var(--text-dim);">Pratiquant:</strong><br>
                        <span id="resultStudentName" style="color: var(--secondary);"></span>
                    </div>
                    <div>
                        <strong style="color: var(--text-dim);">Coach:</strong><br>
                        <span id="resultObserverName" style="color: var(--secondary);"></span>
                    </div>
                    <div>
                        <strong style="color: var(--text-dim);">Classe:</strong><br>
                        <span id="resultClassName" style="color: var(--secondary);"></span>
                        <span id="resultGroupName" style="color: var(--secondary);"></span>
                    </div>
                    <div>
                        <strong style="color: var(--text-dim);">Date:</strong><br>
                        <span id="resultDate" style="color: var(--secondary);"></span>
                    </div>
                </div>
            </div>
            
            <!-- Graphique de progression du tir -->
            <div id="shootingProgressChart" class="card hidden" style="margin-bottom: 20px;">
                <h3 class="card-title">📈 Progression des tirs</h3>
                <canvas id="shootingChart" style="max-height: 250px;"></canvas>
            </div>
            
            <!-- Badges obtenus -->
            <div id="badgesSection" class="card" style="margin-bottom: 20px;">
                <h3 class="card-title">🏆 Badges obtenus</h3>
                <div id="badgesContainer" style="display: flex; flex-wrap: wrap; gap: 15px; justify-content: center; padding: 20px 0;"></div>
            </div>
            
            <div class="total-score">
                <div class="score-label">Score Total</div>
                <div class="score-value" id="totalScore">0</div>
                <div class="score-label">points</div>
            </div>
            
            <div class="card">
                <h3 class="card-title">📊 Détail des points</h3>
                <div id="scoreDetails"></div>
            </div>
            
            <div style="margin-top: 30px; display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <button class="btn btn-secondary btn-full" onclick="downloadCSV()">
                    <span>📊 Télécharger CSV</span>
                </button>
                <button class="btn btn-secondary btn-full" onclick="generateQRCode()">
                    <span>📱 Générer QR Code</span>
                </button>
            </div>
            
            <div id="qrCodeContainer" style="margin-top: 20px; text-align: center; display: none;">
                <canvas id="qrCodeCanvas" style="display: none;"></canvas>
            </div>
            
            <!-- Bouton classement -->
            <button class="btn btn-secondary btn-full" onclick="showLeaderboard()" style="margin-top: 15px;">
                <span>🏅 Voir le classement de classe</span>
            </button>
            
            <button class="btn btn-primary btn-full" onclick="resetApp()">
                <span>🔄 Nouvelle séance</span>
            </button>
        </div>
    </div>

    <script>
        // Barèmes
        const EXERCISE_THRESHOLDS = {
            'JUMPING JACK': [
                { min: 0, max: 19, points: 0 },
                { min: 20, max: 29, points: 10 },
                { min: 30, max: 34, points: 20 },
                { min: 35, max: 39, points: 30 },
                { min: 40, max: 44, points: 40 },
                { min: 45, max: Infinity, points: 50 }
            ],
            '1/2 BURPEES': [
                { min: 0, max: 3, points: 0 },
                { min: 4, max: 5, points: 10 },
                { min: 6, max: 7, points: 20 },
                { min: 8, max: 9, points: 30 },
                { min: 10, max: 14, points: 40 },
                { min: 15, max: Infinity, points: 50 }
            ],
            'SAUT À LA CORDE': [
                { min: 0, max: 9, points: 0 },
                { min: 10, max: 29, points: 10 },
                { min: 30, max: 49, points: 20 },
                { min: 50, max: 69, points: 30 },
                { min: 70, max: 89, points: 40 },
                { min: 90, max: Infinity, points: 50 }
            ],
            'STEP UP': [
                { min: 0, max: 9, points: 0 },
                { min: 10, max: 14, points: 10 },
                { min: 15, max: 19, points: 20 },
                { min: 20, max: 24, points: 30 },
                { min: 25, max: 29, points: 40 },
                { min: 30, max: Infinity, points: 50 }
            ],
            'POMPES INCLINÉES': [
                { min: 0, max: 4, points: 0 },
                { min: 5, max: 9, points: 10 },
                { min: 10, max: 14, points: 20 },
                { min: 15, max: 19, points: 30 },
                { min: 20, max: 24, points: 40 },
                { min: 25, max: Infinity, points: 50 }
            ],
            'ALLER RETOURS': [
                { min: 0, max: 3, points: 0 },
                { min: 4, max: 5, points: 10 },
                { min: 6, max: 7, points: 20 },
                { min: 8, max: 9, points: 30 },
                { min: 10, max: 11, points: 40 },
                { min: 12, max: Infinity, points: 50 }
            ],
            'SAUTS LATÉRAUX': [
                { min: 0, max: 9, points: 0 },
                { min: 10, max: 14, points: 10 },
                { min: 15, max: 19, points: 20 },
                { min: 20, max: 29, points: 30 },
                { min: 30, max: 44, points: 40 },
                { min: 45, max: Infinity, points: 50 }
            ],
            'SAUTS GROUPÉS': [
                { min: 0, max: 9, points: 0 },
                { min: 10, max: 14, points: 10 },
                { min: 15, max: 19, points: 15 },
                { min: 20, max: 29, points: 20 },
                { min: 30, max: 39, points: 25 },
                { min: 40, max: 49, points: 30 },
                { min: 50, max: Infinity, points: 50 }
            ],
            'MONTÉES DE GENOUX': [
                { min: 0, max: 9, points: 0 },
                { min: 10, max: 14, points: 10 },
                { min: 15, max: 19, points: 15 },
                { min: 20, max: 29, points: 20 },
                { min: 30, max: 39, points: 25 },
                { min: 40, max: 49, points: 30 },
                { min: 50, max: Infinity, points: 50 }
            ],
            'SQUATS': [
                { min: 0, max: 9, points: 0 },
                { min: 10, max: 14, points: 10 },
                { min: 15, max: 19, points: 15 },
                { min: 20, max: 29, points: 20 },
                { min: 30, max: 39, points: 25 },
                { min: 40, max: 49, points: 30 },
                { min: 50, max: Infinity, points: 50 }
            ],
            'MOUNTAIN CLIMBERS': [
                { min: 0, max: 9, points: 0 },
                { min: 10, max: 14, points: 10 },
                { min: 15, max: 19, points: 15 },
                { min: 20, max: 29, points: 20 },
                { min: 30, max: 39, points: 25 },
                { min: 40, max: 49, points: 30 },
                { min: 50, max: Infinity, points: 50 }
            ]
,
            'PLANCHE MILITAIRE': [
                { min: 0, max: 2, points: 0 },
                { min: 3, max: 6, points: 10 },
                { min: 7, max: 9, points: 15 },
                { min: 10, max: 12, points: 20 },
                { min: 13, max: 16, points: 25 },
                { min: 17, max: 19, points: 30 },
                { min: 20, max: Infinity, points: 50 }
            ],

            'FENTES AVANT': [
                { min: 0, max: 2, points: 0 },
                { min: 3, max: 6, points: 10 },
                { min: 7, max: 9, points: 15 },
                { min: 10, max: 12, points: 20 },
                { min: 13, max: 16, points: 25 },
                { min: 17, max: 19, points: 30 },
                { min: 20, max: Infinity, points: 50 }
            ],

            'FENTES LATÉRALES': [
                { min: 0, max: 2, points: 0 },
                { min: 3, max: 6, points: 10 },
                { min: 7, max: 9, points: 15 },
                { min: 10, max: 12, points: 20 },
                { min: 13, max: 16, points: 25 },
                { min: 17, max: 19, points: 30 },
                { min: 20, max: Infinity, points: 50 }
            ],
        };
        
        const SHOOTING_POINTS = {
            3: 5,
            5: 10,
            8: 20
        };
        
        // Fonction pour adapter les seuils en fonction du temps sélectionné
        // Les barèmes sont calibrés pour 45 secondes
        function getAdaptedThresholds(exerciseName, timeInSeconds) {
            const baseThresholds = EXERCISE_THRESHOLDS_N[normExName(exerciseName)];
            if (!baseThresholds) return null;
            
            // Temps de référence : 45 secondes
            const referenceTime = 45;
            const ratio = timeInSeconds / referenceTime;
            
            // Adapter chaque seuil proportionnellement
            return baseThresholds.map(threshold => ({
                min: threshold.min === 0 ? 0 : Math.round(threshold.min * ratio),
                max: threshold.max === Infinity ? Infinity : Math.round(threshold.max * ratio),
                points: threshold.points
            }));
        }
        
        const EXERCISE_INSTRUCTIONS = {
            'SAUT À LA CORDE': {
                title: '🪢 Sauts à la corde',
                text: '<strong>Pratiquant :</strong> Sauter à pieds joints, les deux pieds se posent simultanément.<br><strong>Coach :</strong> Compter une répétition pour chaque saut réussi.'
            },
            'JUMPING JACK': {
                title: '🤸 Jumping Jacks',
                text: '<strong>Pratiquant :</strong> Départ pieds joints, bras le long du corps. Écarter les pieds et ramener les bras au-dessus de la tête, puis revenir en position initiale.<br><strong>Coach :</strong> Compter quand les pieds reviennent en position jointe.'
            },
            '1/2 BURPEES': {
                title: '💪 1/2 Burpees avec extension',
                text: '<strong>Pratiquant :</strong> Debout → mains au sol → allonger les jambes → saut groupé → saut extension bras levés.<br><strong>Coach :</strong> Compter après chaque saut extension (pieds décollés du sol).'
            },
            'STEP UP': {
                title: '📦 Step Up (Montées-Descentes)',
                text: '<strong>Pratiquant :</strong> Face au banc/steps, monter un pied après l\'autre (pieds à plat sur le support), puis redescendre.<br><strong>Coach :</strong> Compter une répétition au retour au sol des deux pieds.'
            },
            'POMPES INCLINÉES': {
                title: '🏋️ Pompes inclinées',
                text: '<strong>Pratiquant :</strong> Pompes en appui surélevé (steps/table). Angle bras/avant-bras < 45 degrés.<br><strong>Coach :</strong> Compter quand le pratiquant repousse bras tendus.'
            },
            'ALLER RETOURS': {
                title: '🏃 Allers-Retours largeur volley',
                text: '<strong>Pratiquant :</strong> Réaliser des allers-retours sur 7m en touchant les cônes.<br><strong>Coach :</strong> Compter un aller-retour si les 2 cônes ont été touchés.'
            },
            'SAUTS LATÉRAUX': {
                title: '↔️ Sauts latéraux',
                text: '<strong>Pratiquant :</strong> Sauts en aller-retour de chaque côté d\'une ligne sans la mordre.<br><strong>Coach :</strong> Compter si les 2 pieds sont posés ensemble de chaque côté sans mordre la ligne.'
            },
            'SAUTS GROUPÉS': {
                title: '🦘 Sauts groupés (kangourou)',
                text: '<strong>Pratiquant :</strong> Pieds joints, effectuer des sauts en ramenant les genoux vers la poitrine à chaque saut.<br><strong>Coach :</strong> Compter une répétition pour chaque saut groupé avec les genoux montés.'
            },
            'MONTÉES DE GENOUX': {
                title: '🦵 Montées de genoux (skipping)',
                text: '<strong>Pratiquant :</strong> Course sur place en montant les genoux le plus haut possible (idéalement à hauteur de hanche).<br><strong>Coach :</strong> Compter une répétition à chaque fois qu\'un genou atteint la hauteur requise.'
            },
            'SQUATS': {
                title: '🏋️ Squats (flexions de jambes)',
                text: '<strong>Pratiquant :</strong> Debout, pieds écartés largeur d\'épaules, descendre en fléchissant les jambes (cuisses parallèles au sol) puis remonter.<br><strong>Coach :</strong> Compter une répétition quand le pratiquant est revenu en position debout.'
            },
            'MOUNTAIN CLIMBERS': {
                title: '⛰️ Mountain Climbers',
                text: '<strong>Pratiquant :</strong> Position de planche (gainage), ramener alternativement les genoux vers la poitrine en gardant le dos droit.<br><strong>Coach :</strong> Compter une répétition à chaque changement de jambe.'
            }
,
            'PLANCHE MILITAIRE': {
                title: '🪖 Planche militaire (commando)',
                text: '<strong>Pratiquant :</strong> En planche, descendre sur un avant-bras puis l\'autre, puis remonter sur la main puis l\'autre, buste gainé.<br><strong>Coach :</strong> Compter 1 répétition après le passage sur <em>les 2 bras</em> (descente + remontée complètes).<br><strong>À valider :</strong> Gainage (bassin stable), mains sous épaules, amplitude complète.'
            },

            'FENTES AVANT': {
                title: '🦵 Fentes avant',
                text: '<strong>Pratiquant :</strong> Alterner une fente avant jambe droite puis jambe gauche, buste droit.<br><strong>Coach :</strong> Compter 1 répétition quand <em>les 2 jambes</em> sont passées en fente (droite + gauche).<br><strong>À valider :</strong> Genou avant aligné (pas trop au-delà du pied), talon arrière décollé, retour en position debout contrôlé.'
            },

            'FENTES LATÉRALES': {
                title: '↔️ Fentes latérales',
                text: '<strong>Pratiquant :</strong> Fléchir une jambe sur le côté en gardant l\'autre tendue, puis alterner droite/gauche.<br><strong>Coach :</strong> Compter 1 répétition quand <em>les 2 jambes</em> ont exécuté la fente latérale (droite + gauche).<br><strong>À valider :</strong> Pieds à plat, hanches en arrière, dos droit, amplitude suffisante.'
            },
        };
        
        function calculateExercisePoints(exerciseName, reps) {
            // Utiliser les seuils adaptés au temps de l'exercice
            const adaptedThresholds = getAdaptedThresholds(exerciseName, state.exerciseTime);
            if (!adaptedThresholds) return 0;
            
            // Trouver entre quels paliers on se situe
            for (let i = 0; i < adaptedThresholds.length - 1; i++) {
                const current = adaptedThresholds[i];
                const next = adaptedThresholds[i + 1];
                
                // Si on est dans cet intervalle
                if (reps >= current.min && reps <= current.max) {
                    // Si on est au dernier palier (Infinity), retourner le max
                    if (next.max === Infinity && reps >= next.min) {
                        return next.points;
                    }
                    
                    // Interpolation linéaire entre current.points et next.points
                    const rangeReps = current.max - current.min + 1; // Nombre de reps dans l'intervalle
                    const progressInRange = reps - current.min; // Position dans l'intervalle
                    const pointsRange = next.points - current.points; // Différence de points
                    
                    // Calcul proportionnel
                    const interpolatedPoints = current.points + (progressInRange / rangeReps) * pointsRange;
                    
                    return Math.round(interpolatedPoints * 10) / 10; // Arrondi à 1 décimale
                }
            }
            
            // Si on est au dernier palier
            const lastThreshold = adaptedThresholds[adaptedThresholds.length - 1];
            if (reps >= lastThreshold.min) {
                return lastThreshold.points;
            }
            
            return 0;
        }
        
        // État
        let state = {
            studentName: '',
            observerName: '',
            className: '',
            groupName: '',
            sessionDate: '',
            sessionTime: '',
            exercises: [], // Types d'exercices sélectionnés par l'utilisateur
            exerciseTypes: [], // Copie pour générer la séquence
            numExercises: 4, // Nombre total d'exercices à faire
            numShootingSessions: 1,
            exerciseTime: 45,
            pauseTime: 15,
            sequence: [],
            currentSequenceIndex: 0,
            currentReps: 0,
            currentHits: 0,
            tabataTime: 45,
            tabataRunning: false,
            tabataInterval: null,
            isInWorkPhase: true,
            totalTime: 0,
            totalTimeRunning: false,
            totalTimeInterval: null,
            results: [],
            shootingDistance: 3,
            soundEnabled: true, // Bips sonores activés par défaut
            // MODE ÉQUIPE
            gameMode: 'solo', // 'solo' ou 'team'
            teams: [],
            currentTeamIndex: 0,
            currentRunnerIndex: 0,
            teamMatchId: null,
            waitingForNextRunner: false // Flag pour éviter l'auto-start entre coureurs
        };
        
        // Couleurs d'équipes (6 couleurs pour 6 équipes possibles en parallèle)
        const TEAM_COLORS = [
            { name: 'Rouge', emoji: '🔴', color: '#FF3366', border: '#FF0033' },
            { name: 'Bleue', emoji: '🔵', color: '#3366FF', border: '#0033FF' },
            { name: 'Verte', emoji: '🟢', color: '#33FF66', border: '#00FF33' },
            { name: 'Jaune', emoji: '🟡', color: '#FFCC33', border: '#FF9900' },
            { name: 'Violette', emoji: '🟣', color: '#9933FF', border: '#6600CC' },
            { name: 'Orange', emoji: '🟠', color: '#FF9933', border: '#FF6600' },
        ];
        
        // Fonction pour jouer un bip sonore
        function playBeep(type = 'start') {
            if (!state.soundEnabled) return;
            
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            if (type === 'start') {
                // Bip de démarrage : son aigu et court
                oscillator.frequency.value = 880; // La5
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.1);
            } else if (type === 'end') {
                // Bip de fin : double bip
                oscillator.frequency.value = 440; // La4
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.15);
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.15);
                
                // Deuxième bip
                setTimeout(() => {
                    const osc2 = audioContext.createOscillator();
                    const gain2 = audioContext.createGain();
                    osc2.connect(gain2);
                    gain2.connect(audioContext.destination);
                    osc2.frequency.value = 880;
                    gain2.gain.setValueAtTime(0.3, audioContext.currentTime);
                    gain2.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.15);
                    osc2.start(audioContext.currentTime);
                    osc2.stop(audioContext.currentTime + 0.15);
                }, 150);
            }
        }
        
        // Fonction pour vibrer (retour haptique)
        function vibrate() {
            if ('vibrate' in navigator) {
                navigator.vibrate(50); // Vibration courte de 50ms
            }
        }
        
        // Fonction pour toggle le son
        function toggleSound() {
            const toggle = document.getElementById('soundToggle');
            toggle.checked = !toggle.checked;
            state.soundEnabled = toggle.checked;
        }
        
        function toggleSoundSetting() {
            const toggle = document.getElementById('soundToggleSettings');
            toggle.checked = !toggle.checked;
            state.soundEnabled = toggle.checked;
        }
        
        // Fonctions pour le modal réglages
        function openSettings() {
            document.getElementById('settingsModal').classList.remove('hidden');
            // Synchroniser le toggle avec l'état actuel
            document.getElementById('soundToggleSettings').checked = state.soundEnabled;
        }
        
        function closeSettings() {
            document.getElementById('settingsModal').classList.add('hidden');
        }
        
        // Fonction pour changer de thème
        function changeTheme(theme) {
            const root = document.documentElement;
            
            // Retirer la classe active de tous les boutons
            document.querySelectorAll('.theme-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Ajouter la classe active au bouton sélectionné
            document.querySelector(`[data-theme="${theme}"]`).classList.add('active');
            
            // Changer les couleurs CSS selon le thème
            switch(theme) {
                case 'cyan':
                    root.style.setProperty('--primary', '#FF0066');
                    root.style.setProperty('--secondary', '#00FFCC');
                    root.style.setProperty('--tertiary', '#FFAA00');
                    root.style.setProperty('--success', '#00FF88');
                    break;
                case 'blue':
                    root.style.setProperty('--primary', '#FF6600');
                    root.style.setProperty('--secondary', '#0099FF');
                    root.style.setProperty('--tertiary', '#FF9900');
                    root.style.setProperty('--success', '#00CC99');
                    break;
                case 'purple':
                    root.style.setProperty('--primary', '#FF0088');
                    root.style.setProperty('--secondary', '#CC00FF');
                    root.style.setProperty('--tertiary', '#FFCC00');
                    root.style.setProperty('--success', '#88FF00');
                    break;
                case 'green':
                    root.style.setProperty('--primary', '#FF0088');
                    root.style.setProperty('--secondary', '#00FF88');
                    root.style.setProperty('--tertiary', '#FF6600');
                    root.style.setProperty('--success', '#00FFAA');
                    break;
            }
            
            vibrate(); // Retour haptique lors du changement
        }
        
        // Fonction pour toggle le panneau de réglages
        function toggleSettings() {
            const panel = document.getElementById('settingsPanel');
            panel.classList.toggle('hidden');
        }
        
        // Fonction pour toggle l'auto-actualisation date/heure
        function toggleAutoDateTime() {
            const toggle = document.getElementById('autoDateTimeToggle');
            const dateInput = document.getElementById('sessionDate');
            const timeInput = document.getElementById('sessionTime');
            
            if (toggle.checked) {
                // Mode auto : désactiver les champs et mettre à jour
                dateInput.disabled = true;
                timeInput.disabled = true;
                updateDateTime();
            } else {
                // Mode manuel : activer les champs
                dateInput.disabled = false;
                timeInput.disabled = false;
            }
        }
        
        // Fonction pour mettre à jour date et heure actuelles
        function updateDateTime() {
            const now = new Date();
            const dateInput = document.getElementById('sessionDate');
            const timeInput = document.getElementById('sessionTime');
            
            // Format YYYY-MM-DD
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            dateInput.value = `${year}-${month}-${day}`;
            
            // Format HH:MM
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            timeInput.value = `${hours}:${minutes}`;
        }
        
        // Fonction pour synchroniser le toggle du son
        function updateSoundSetting() {
            const toggle = document.getElementById('soundToggleSettings');
            state.soundEnabled = toggle.checked;
        }
        
        // Thèmes de couleurs (optimisés pour mode CLAIR)
        const themes = {
            cyan: {
                primary: '#00E5CC',
                secondary: '#00FFDD',
                tertiary: '#33FFEE',
                success: '#66FFF5',
                bgLight: '#A0E7E5',
                bgCard: '#FFFFFF',
                textDark: '#02475E'
            },
            purple: {
                primary: '#7209B7',
                secondary: '#B388EB',
                tertiary: '#8E44AD',
                success: '#9D4EDD',
                bgLight: '#D4A5F5',
                bgCard: '#FFFFFF',
                textDark: '#4A148C'
            },
            green: {
                primary: '#3FD67F',
                secondary: '#6FDC8C',
                tertiary: '#4FE68F',
                success: '#8FEBB7',
                bgLight: '#95D5B2',
                bgCard: '#FFFFFF',
                textDark: '#1B4332'
            },
            orange: {
                primary: '#E85D04',
                secondary: '#F48C06',
                tertiary: '#DC2F02',
                success: '#FAA307',
                bgLight: '#FFCB9A',
                bgCard: '#FFFFFF',
                textDark: '#6A2C0A'
            },
            blue: {
                primary: '#1976D2',
                secondary: '#42A5F5',
                tertiary: '#1565C0',
                success: '#64B5F6',
                bgLight: '#90CAF9',
                bgCard: '#FFFFFF',
                textDark: '#0D47A1'
            },
            white: {
                primary: '#FFFFFF',
                secondary: '#FFFFFF',
                tertiary: '#F5F5F5',
                success: '#EEEEEE',
                bgLight: '#FFFFFF',
                bgCard: '#F5F5F5',
                textDark: '#1a1a2e'
            }
        };
        
        // Fonction pour changer le thème
        function changeTheme() {
            const themeSelector = document.getElementById('themeSelector');
            const selectedTheme = themeSelector.value;
            const theme = themes[selectedTheme];
            
            if (theme) {
                const root = document.documentElement;
                const body = document.body;
                
                console.log('=== CHANGEMENT DE THÈME ===');
                console.log('Thème sélectionné:', selectedTheme);
                
                // Appliquer les couleurs principales
                root.style.setProperty('--primary', theme.primary);
                root.style.setProperty('--secondary', theme.secondary);
                root.style.setProperty('--tertiary', theme.tertiary);
                root.style.setProperty('--success', theme.success);
                
                // Vérifier le mode (sombre ou clair)
                const isDarkMode = !body.classList.contains('light-mode');
                
                if (isDarkMode) {
                    // MODE SOMBRE : Fond noir avec couleurs vives pour les accents
                    console.log('🌙 MODE SOMBRE → Fond noir, accents colorés');
                    root.style.setProperty('--bg-dark', '#0a0a0a');
                    root.style.setProperty('--bg-card', '#1a1a1a');
                    root.style.setProperty('--text', '#ffffff');
                    root.style.setProperty('--text-dim', '#cccccc');
                    
                    body.style.cssText = 'background: #0a0a0a !important; color: #ffffff !important;';
                    root.style.background = '#0a0a0a';
                    
                    // Si thème blanc en mode sombre : boutons blancs avec texte noir
                    if (selectedTheme === 'white') {
                        console.log('⚪ Thème BLANC → Boutons blancs avec texte noir');
                        const style = document.createElement('style');
                        style.id = 'white-theme-override';
                        
                        // Supprimer l'ancien style s'il existe
                        const oldStyle = document.getElementById('white-theme-override');
                        if (oldStyle) oldStyle.remove();
                        
                        style.textContent = `
                            .btn-primary {
                                background: linear-gradient(135deg, #FFFFFF, #F0F0F0) !important;
                                color: #000000 !important;
                                box-shadow: 0 4px 20px rgba(255, 255, 255, 0.3) !important;
                            }
                            .btn-primary:hover {
                                box-shadow: 0 6px 30px rgba(255, 255, 255, 0.5) !important;
                            }
                            .btn-secondary {
                                background: linear-gradient(135deg, #FFFFFF, #F0F0F0) !important;
                                color: #000000 !important;
                                box-shadow: 0 4px 20px rgba(255, 255, 255, 0.3) !important;
                            }
                            .btn-secondary:hover {
                                box-shadow: 0 6px 30px rgba(255, 255, 255, 0.5) !important;
                            }
                        `;
                        document.head.appendChild(style);
                    } else {
                        // Retirer le style blanc si on change de thème
                        const oldStyle = document.getElementById('white-theme-override');
                        if (oldStyle) oldStyle.remove();
                    }
                } else {
                    // MODE CLAIR : Fond coloré selon le thème
                    console.log('☀️ MODE CLAIR → Fond coloré:', theme.bgLight);
                    root.style.setProperty('--bg-dark', theme.bgLight);
                    root.style.setProperty('--bg-card', theme.bgCard);
                    root.style.setProperty('--text', theme.textDark);
                    root.style.setProperty('--text-dim', '#666666');
                    
                    body.style.cssText = `background: ${theme.bgLight} !important; color: ${theme.textDark} !important;`;
                    root.style.background = theme.bgLight;
                    
                    // Si thème blanc en mode clair : styles spéciaux
                    if (selectedTheme === 'white') {
                        console.log('⚪ Mode CLAIR Blanc → Titres noirs, bordures noires, flèches roses');
                        const style = document.createElement('style');
                        style.id = 'white-theme-override';
                        
                        // Supprimer l'ancien style s'il existe
                        const oldStyle = document.getElementById('white-theme-override');
                        if (oldStyle) oldStyle.remove();
                        
                        style.textContent = `
                            /* Tous les titres et textes en noir */
                            body.light-mode,
                            body.light-mode *:not(.btn):not(.btn *) {
                                color: #000000 !important;
                            }
                            
                            /* Titre principal de l'app en NOIR solide (pas transparent) */
                            .header h1 {
                                background: none !important;
                                -webkit-background-clip: unset !important;
                                -webkit-text-fill-color: #000000 !important;
                                background-clip: unset !important;
                                color: #000000 !important;
                            }
                            
                            /* Tous les autres titres */
                            .header h1 *,
                            .card-title,
                            h1, h2, h3, h4, h5, h6 {
                                color: #000000 !important;
                            }
                            
                            /* Compteurs en noir */
                            #repCounter,
                            #hitCounter,
                            .counter-display,
                            #totalTimeDisplay,
                            #tabataDisplay,
                            #tabataDisplay2 {
                                color: #000000 !important;
                            }
                            
                            /* Labels et textes en noir */
                            label,
                            p, span, div {
                                color: #000000 !important;
                            }
                            
                            /* Inputs avec bordures noires */
                            body.light-mode input[type="number"],
                            body.light-mode input[type="text"],
                            body.light-mode input[type="date"],
                            body.light-mode input[type="time"],
                            body.light-mode select {
                                border: 2px solid #000000 !important;
                                color: #000000 !important;
                            }
                            
                            /* Exercices sélectionnés encadrés en ROSE */
                            .exercise-item {
                                border: 2px solid #FF0066 !important;
                                background: rgba(255, 0, 102, 0.05) !important;
                            }
                            
                            /* Chronomètres avec bordures ROSE */
                            .total-timer,
                            .tabata-timer,
                            .tabata-display-container {
                                border: 2px solid #FF0066 !important;
                            }
                            
                            /* Compteurs (répétitions et tirs) avec bordures ROSE */
                            .counter-section {
                                border: 2px solid #FF0066 !important;
                            }
                            
                            /* Bouton circulaire de démarrage en ROSE */
                            .btn-circular-start {
                                background: linear-gradient(135deg, #FF0066, #FF3399) !important;
                                box-shadow: 0 8px 30px rgba(255, 0, 102, 0.5) !important;
                            }
                            
                            .btn-circular-start:hover {
                                box-shadow: 0 12px 40px rgba(255, 0, 102, 0.7) !important;
                            }
                            
                            /* Flèches select en rose */
                            body.light-mode select {
                                background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%23FF0066' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E") !important;
                            }
                            
                            /* Toggles en gris #666666 (pas blanc) */
                            body.light-mode .toggle-slider {
                                border: 2px solid #666666 !important;
                            }
                            
                            body.light-mode .toggle-input:checked + .toggle-slider {
                                background-color: #666666 !important;
                                border-color: #666666 !important;
                            }
                            
                            /* Boutons ▲▼ de réorganisation en ROSE */
                            .reorder-btn {
                                background: #FF0066 !important;
                                color: white !important;
                                border: none !important;
                                opacity: 1 !important;
                            }
                            
                            .reorder-btn:hover {
                                background: #cc0052 !important;
                            }
                            
                            .reorder-btn:disabled {
                                background: #FFB3D9 !important;
                                opacity: 0.5 !important;
                            }
                            
                            /* Boutons avec couleurs normales */
                            .btn-primary,
                            .btn-secondary {
                                color: #000000 !important;
                                opacity: 1 !important;
                            }
                        `;
                        document.head.appendChild(style);
                    } else {
                        // Retirer le style blanc en mode clair normal
                        const oldStyle = document.getElementById('white-theme-override');
                        if (oldStyle) oldStyle.remove();
                    }
                }
                
                // Sauvegarder le thème
                localStorage.setItem('laserfit-theme', selectedTheme);
                console.log('Thème appliqué avec succès');
                console.log('========================\n');
            }
        }
        
        // Fonction pour toggle le mode sombre/clair
        function toggleDarkMode() {
            const toggle = document.getElementById('darkModeToggle');
            const body = document.body;
            
            console.log('\n=== TOGGLE MODE SOMBRE/CLAIR ===');
            console.log('État du toggle:', toggle.checked ? 'ON (sombre)' : 'OFF (clair)');
            
            if (toggle.checked) {
                // Mode sombre
                body.classList.remove('light-mode');
                localStorage.setItem('laserfit-dark-mode', 'true');
                console.log('🌙 Mode sombre → Fond noir avec accents colorés');
            } else {
                // Mode clair
                body.classList.add('light-mode');
                localStorage.setItem('laserfit-dark-mode', 'false');
                console.log('☀️ Mode clair → Fond coloré selon le thème');
            }
            
            // Réappliquer le thème
            changeTheme();
        }
        
        // Charger le thème sauvegardé au démarrage
        window.addEventListener('DOMContentLoaded', () => {
            const savedTheme = localStorage.getItem('laserfit-theme');
            if (savedTheme) {
                document.getElementById('themeSelector').value = savedTheme;
                changeTheme();
            }
            
            // Charger le mode sombre/clair sauvegardé
            const darkMode = localStorage.getItem('laserfit-dark-mode');
            const darkModeToggle = document.getElementById('darkModeToggle');
            
            if (darkMode === 'false') {
                darkModeToggle.checked = false;
                document.body.classList.add('light-mode');
            } else {
                darkModeToggle.checked = true;
                document.body.classList.remove('light-mode');
            }
        });
        
        // Fonction helper pour synchroniser les deux affichages du chrono
        function updateTabataDisplay(value) {
            document.getElementById('tabataDisplay').textContent = value;
            document.getElementById('tabataDisplay2').textContent = value;
        }
        
        function updateTabataPhase(text, className) {
            // Pour le chrono circulaire, on ne gère que le texte et la couleur
            document.getElementById('tabataPhase').textContent = text;
            document.getElementById('tabataPhase2').textContent = text;
            
            // Changer la couleur selon la phase
            if (text === 'EXERCICE') {
                document.getElementById('tabataPhase').style.color = 'var(--success)';
                document.getElementById('tabataPhase2').style.color = 'var(--success)';
            } else {
                document.getElementById('tabataPhase').style.color = 'var(--tertiary)';
                document.getElementById('tabataPhase2').style.color = 'var(--tertiary)';
            }
        }
        
        function addTabataWarning() {
            document.getElementById('tabataDisplay').classList.add('warning');
            document.getElementById('tabataDisplay2').classList.add('warning');
        }
        
        function removeTabataWarning() {
            document.getElementById('tabataDisplay').classList.remove('warning');
            document.getElementById('tabataDisplay2').classList.remove('warning');
        }
        
        // Générer la séquence
        function generateSequence(numExercises, numShootingSessions, exerciseTypes) {
            const sequence = [];
            
            if (numShootingSessions === 0) {
                // Pas de tirs, juste les exercices
                for (let i = 0; i < numExercises; i++) {
                    const exerciseType = exerciseTypes[i % exerciseTypes.length];
                    sequence.push({ 
                        type: 'exercise', 
                        name: exerciseType, 
                        number: i + 1 
                    });
                }
            } else if (numShootingSessions === 1) {
                // 1 session de tir : diviser les exercices en 2 blocs
                const halfExercises = Math.floor(numExercises / 2);
                
                // Premier bloc
                for (let i = 0; i < halfExercises; i++) {
                    const exerciseType = exerciseTypes[i % exerciseTypes.length];
                    sequence.push({ 
                        type: 'exercise', 
                        name: exerciseType, 
                        number: i + 1 
                    });
                }
                
                // Tir au milieu
                sequence.push({ type: 'shooting', session: 1 });
                
                // Deuxième bloc
                for (let i = halfExercises; i < numExercises; i++) {
                    const exerciseType = exerciseTypes[i % exerciseTypes.length];
                    sequence.push({ 
                        type: 'exercise', 
                        name: exerciseType, 
                        number: i + 1 
                    });
                }
            } else if (numShootingSessions === 2) {
                // 2 sessions de tir : diviser en 3 blocs
                const thirdExercises = Math.floor(numExercises / 3);
                
                // Premier bloc
                for (let i = 0; i < thirdExercises; i++) {
                    const exerciseType = exerciseTypes[i % exerciseTypes.length];
                    sequence.push({ 
                        type: 'exercise', 
                        name: exerciseType, 
                        number: i + 1 
                    });
                }
                
                // Premier tir
                sequence.push({ type: 'shooting', session: 1 });
                
                // Deuxième bloc
                for (let i = thirdExercises; i < thirdExercises * 2; i++) {
                    const exerciseType = exerciseTypes[i % exerciseTypes.length];
                    sequence.push({ 
                        type: 'exercise', 
                        name: exerciseType, 
                        number: i + 1 
                    });
                }
                
                // Deuxième tir
                sequence.push({ type: 'shooting', session: 2 });
                
                // Troisième bloc
                for (let i = thirdExercises * 2; i < numExercises; i++) {
                    const exerciseType = exerciseTypes[i % exerciseTypes.length];
                    sequence.push({ 
                        type: 'exercise', 
                        name: exerciseType, 
                        number: i + 1 
                    });
                }
            } else if (numShootingSessions === 3) {
                // 3 sessions de tir : tir + bloc + tir + bloc + tir
                const halfExercises = Math.floor(numExercises / 2);
                
                // Premier tir
                sequence.push({ type: 'shooting', session: 1 });
                
                // Premier bloc
                for (let i = 0; i < halfExercises; i++) {
                    const exerciseType = exerciseTypes[i % exerciseTypes.length];
                    sequence.push({ 
                        type: 'exercise', 
                        name: exerciseType, 
                        number: i + 1 
                    });
                }
                
                // Deuxième tir
                sequence.push({ type: 'shooting', session: 2 });
                
                // Deuxième bloc
                for (let i = halfExercises; i < numExercises; i++) {
                    const exerciseType = exerciseTypes[i % exerciseTypes.length];
                    sequence.push({ 
                        type: 'exercise', 
                        name: exerciseType, 
                        number: i + 1 
                    });
                }
                
                // Troisième tir
                sequence.push({ type: 'shooting', session: 3 });
            }
            
            return sequence;
        }
        
        // Générer la séquence en respectant l'ordre choisi par l'utilisateur
        function generateSequenceFromOrder(orderedItems) {
            const sequence = [];
            let exerciseCounter = 1;
            let sessionCounter = 1;
            
            orderedItems.forEach(item => {
                if (item.includes('🎯 TIR LASER')) {
                    // C'est un tir
                    sequence.push({ 
                        type: 'shooting', 
                        session: sessionCounter++
                    });
                } else {
                    // C'est un exercice
                    sequence.push({ 
                        type: 'exercise', 
                        name: item, 
                        number: exerciseCounter++
                    });
                }
            });
            
            return sequence;
        }
        
        // Navigation
        function goToConfig() {
            const studentName = document.getElementById('studentName').value.trim();
            const observerName = document.getElementById('observerName').value.trim();
            const className = document.getElementById('className').value.trim();
            const groupName = document.getElementById('groupName').value.trim();
            const sessionDate = document.getElementById('sessionDate').value;
            const sessionTime = document.getElementById('sessionTime').value;
            
            if (!studentName || !observerName || !className || !sessionDate || !sessionTime) {
                alert('Veuillez remplir tous les champs obligatoires avant de continuer.');
                return;
            }
            
            state.studentName = studentName;
            state.observerName = observerName;
            state.className = className;
            state.groupName = groupName; // Optionnel
            state.sessionDate = sessionDate;
            state.sessionTime = sessionTime;
            
            document.getElementById('infoScreen').classList.add('hidden');
            document.getElementById('configScreen').classList.remove('hidden');
        }
        
        document.getElementById('exerciseSelector').addEventListener('change', function() {
            const exercise = this.value;
            console.log('Exercice sélectionné:', exercise);
            console.log('Exercices actuels:', state.exercises);
            console.log('Déjà inclus?', state.exercises.includes(exercise));
            
            if (exercise && !state.exercises.includes(exercise)) {
                state.exercises.push(exercise);
                console.log('Exercice ajouté, liste mise à jour:', state.exercises);
                updateExerciseList();
                this.value = '';
            } else {
                console.log('Exercice non ajouté - raison:', !exercise ? 'vide' : 'déjà présent');
            }
        });
        
        function updateExerciseList() {
            const list = document.getElementById('exerciseList');
            const numExercises = parseInt(document.getElementById('numExercises').value);
            const numShootingSessions = parseInt(document.getElementById('numShootingSessions').value);
            const selector = document.getElementById('exerciseSelector');
            
            // Créer une liste complète avec exercices + tirs
            const completeSequence = [...state.exercises];
            
            // Ajouter les sessions de tir si elles ne sont pas déjà dans la liste
            for (let i = 1; i <= numShootingSessions; i++) {
                const tirLabel = `🎯 TIR LASER (Session ${i})`;
                if (!completeSequence.includes(tirLabel)) {
                    completeSequence.push(tirLabel);
                }
            }
            
            // Retirer les sessions de tir en trop si le nombre a diminué
            for (let i = numShootingSessions + 1; i <= 10; i++) {
                const tirLabel = `🎯 TIR LASER (Session ${i})`;
                const tirIndex = completeSequence.indexOf(tirLabel);
                if (tirIndex !== -1) {
                    completeSequence.splice(tirIndex, 1);
                }
            }
            
            // Mettre à jour state.exercises pour inclure les tirs
            state.exercises = completeSequence;
            
            if (state.exercises.length === 0) {
                list.innerHTML = '';
                selector.disabled = false;
                return;
            }
            
            list.innerHTML = '<label style="margin-top: 20px;">Exercices sélectionnés (ordre chronologique) :</label>';
            state.exercises.forEach((exercise, index) => {
                const item = document.createElement('div');
                item.className = 'exercise-item';
                
                // Style différent pour les tirs
                const isTir = exercise.includes('🎯 TIR LASER');
                if (isTir) {
                    item.style.background = 'rgba(255, 170, 0, 0.1)';
                    item.style.borderColor = 'var(--tertiary)';
                }
                
                const moveButtons = document.createElement('div');
                moveButtons.style.display = 'flex';
                moveButtons.style.gap = '5px';
                moveButtons.style.marginRight = '10px';
                
                // Bouton monter
                const upButton = document.createElement('button');
                upButton.className = 'btn-move';
                upButton.innerHTML = '▲';
                upButton.disabled = index === 0;
                upButton.onclick = () => moveExerciseUp(index);
                if (index === 0) upButton.style.opacity = '0.3';
                
                // Bouton descendre
                const downButton = document.createElement('button');
                downButton.className = 'btn-move';
                downButton.innerHTML = '▼';
                downButton.disabled = index === state.exercises.length - 1;
                downButton.onclick = () => moveExerciseDown(index);
                if (index === state.exercises.length - 1) downButton.style.opacity = '0.3';
                
                moveButtons.appendChild(upButton);
                moveButtons.appendChild(downButton);
                
                const nameSpan = document.createElement('span');
                nameSpan.className = 'exercise-name';
                nameSpan.textContent = exercise;
                nameSpan.style.flex = '1';
                
                // Pas de bouton supprimer pour les tirs (contrôlés par le nombre de sessions)
                if (!isTir) {
                    const deleteButton = document.createElement('button');
                    deleteButton.className = 'exercise-delete';
                    deleteButton.textContent = 'Supprimer';
                    deleteButton.onclick = () => removeExercise(index);
                    item.appendChild(moveButtons);
                    item.appendChild(nameSpan);
                    item.appendChild(deleteButton);
                } else {
                    item.appendChild(moveButtons);
                    item.appendChild(nameSpan);
                }
                
                list.appendChild(item);
            });
            
            // Compter seulement les exercices (pas les tirs) pour le maximum
            const exercisesOnly = state.exercises.filter(e => !e.includes('🎯 TIR LASER'));
            
            // Désactiver le sélecteur si on a atteint le nombre max d'exercices
            if (exercisesOnly.length >= numExercises) {
                selector.disabled = true;
                selector.style.opacity = '0.5';
                selector.style.cursor = 'not-allowed';
                
                // Ajouter un message
                const message = document.createElement('div');
                message.style.color = 'var(--success)';
                message.style.fontSize = '0.9rem';
                message.style.marginTop = '10px';
                message.style.fontWeight = '600';
                message.textContent = `✓ ${numExercises} exercice(s) sélectionné(s) (maximum atteint)`;
                list.appendChild(message);
            } else {
                selector.disabled = false;
                selector.style.opacity = '1';
                selector.style.cursor = 'pointer';
                
                // Ajouter un message de progression
                const message = document.createElement('div');
                message.style.color = 'var(--warning)';
                message.style.fontSize = '0.9rem';
                message.style.marginTop = '10px';
                message.style.fontWeight = '600';
                message.textContent = `⚠️ ${exercisesOnly.length}/${numExercises} exercice(s) sélectionné(s) - Il en manque ${numExercises - exercisesOnly.length}`;
                list.appendChild(message);
            }
        }
        
        function moveExerciseUp(index) {
            if (index > 0) {
                // Échanger avec l'élément au-dessus
                const temp = state.exercises[index];
                state.exercises[index] = state.exercises[index - 1];
                state.exercises[index - 1] = temp;
                updateExerciseList();
            }
        }
        
        function moveExerciseDown(index) {
            if (index < state.exercises.length - 1) {
                // Échanger avec l'élément en-dessous
                const temp = state.exercises[index];
                state.exercises[index] = state.exercises[index + 1];
                state.exercises[index + 1] = temp;
                updateExerciseList();
            }
        }
        
        function removeExercise(index) {
            state.exercises.splice(index, 1);
            updateExerciseList();
        }
        
        function startSession() {
            const numExercises = parseInt(document.getElementById('numExercises').value);
            const numShootingSessions = parseInt(document.getElementById('numShootingSessions').value);
            const exerciseTime = parseInt(document.getElementById('exerciseTime').value);
            const pauseTime = parseInt(document.getElementById('pauseTime').value);
            
            // Compter seulement les exercices (pas les tirs)
            const exercisesOnly = state.exercises.filter(ex => !ex.includes('🎯 TIR LASER'));
            
            if (exercisesOnly.length === 0) {
                alert('Veuillez ajouter au moins un type d\'exercice !');
                return;
            }
            
            // Vérifier que le nombre de types d'exercices correspond (sans compter les tirs)
            if (exercisesOnly.length !== numExercises) {
                alert(`Vous devez sélectionner exactement ${numExercises} type(s) d'exercice(s).\nActuellement : ${exercisesOnly.length} type(s) sélectionné(s).\n\n⚠️ Les sessions de tir se positionnent automatiquement dans la liste ci-dessous.`);
                return;
            }
            
            state.numExercises = numExercises;
            state.numShootingSessions = numShootingSessions;
            state.exerciseTime = exerciseTime;
            state.pauseTime = pauseTime;
            state.exerciseTypes = state.exercises; // Les types d'exercices ET tirs sélectionnés, dans l'ordre choisi
            
            state.sequence = generateSequenceFromOrder(state.exercises);
            state.currentSequenceIndex = 0;
            state.results = [];
            state.totalTime = 0;
            
            // Si mode équipe, aller à l'écran de relais
            if (state.gameMode === 'team') {
                showTeamRelay();
            } else {
                // Mode solo classique
                document.getElementById('configScreen').classList.add('hidden');
                document.getElementById('sessionScreen').classList.remove('hidden');
                
                // Afficher le récapitulatif
                showRecap();
            }
        }
        
        // URLs des démonstrations d'exercices (utilisation d'emojis animés comme fallback)
        const EXERCISE_DEMOS = {
            'SAUT À LA CORDE': 'animations/saut-corde.gif',
            'JUMPING JACK': 'animations/jumping-jack.gif',
            '1/2 BURPEES': 'animations/burpees.gif',
            'STEP UP': 'animations/step-up.gif',
            'POMPES INCLINÉES': 'animations/pompes.gif',
            'ALLER RETOURS': 'animations/aller-retours.gif',
            'SAUTS LATÉRAUX': 'animations/sauts-lateraux.gif',
            'SAUTS GROUPÉS': 'animations/sauts-groupes.gif',
            'MONTÉES DE GENOUX': 'animations/montees-genoux.gif',
            'SQUATS': 'animations/squats.gif',
            'MOUNTAIN CLIMBERS': 'animations/mountain-climber.gif',
            'PLANCHE MILITAIRE': 'animations/planche-militaire.gif',
            'FENTES AVANT': 'animations/fentes-avant.gif',
            'FENTES LATÉRALES': 'animations/fentes-laterales.gif'
        };

        // Normalisation des noms d'exercices (évite les soucis d'accents/espaces selon les appareils)
        function normExName(s) {
            return (s || "")
                .toString()
                .normalize("NFD")
                .replace(/[\u0300-\u036f]/g, "")
                .replace(/\s+/g, " ")
                .trim()
                .toUpperCase();
        }

        // Index normalisés (pour éviter les clés qui ne matchent pas à cause des accents)
        const EXERCISE_DEMOS_N = Object.fromEntries(Object.entries(EXERCISE_DEMOS).map(([k,v]) => [normExName(k), v]));
        const EXERCISE_THRESHOLDS_N = Object.fromEntries(Object.entries(EXERCISE_THRESHOLDS).map(([k,v]) => [normExName(k), v]));
        const EXERCISE_INSTRUCTIONS_N = Object.fromEntries(Object.entries(EXERCISE_INSTRUCTIONS).map(([k,v]) => [normExName(k), v]));

        // Réordonner les ateliers dans le récapitulatif (↑ / ↓)
        function moveAtelierUp(index) {
            if (index <= 0) return;
            const tmp = state.sequence[index - 1];
            state.sequence[index - 1] = state.sequence[index];
            state.sequence[index] = tmp;
            showRecap();
        }

        function moveAtelierDown(index) {
            if (index >= state.sequence.length - 1) return;
            const tmp = state.sequence[index + 1];
            state.sequence[index + 1] = state.sequence[index];
            state.sequence[index] = tmp;
            showRecap();
        }

        
        function showRecap() {
            // Calculer le temps total estimé
            const totalAteliers = state.sequence.length;
            const totalExerciseTime = totalAteliers * state.exerciseTime;
            const totalPauseTime = (totalAteliers - 1) * state.pauseTime; // Pas de pause après le dernier
            const totalSeconds = totalExerciseTime + totalPauseTime;
            const minutes = Math.floor(totalSeconds / 60);
            const seconds = totalSeconds % 60;
            
            document.getElementById('totalEstimatedTime').textContent = 
                `${minutes}:${seconds.toString().padStart(2, '0')}`;
            document.getElementById('totalAteliers').textContent = totalAteliers;
            
            // Afficher la liste des ateliers
            const sequenceDiv = document.getElementById('sequenceRecap');
            sequenceDiv.innerHTML = '<h3 style="color: var(--text-dim); font-size: 1rem; margin-bottom: 15px; text-transform: uppercase; letter-spacing: 1px;">Ordre des ateliers</h3>';
            
            state.sequence.forEach((atelier, index) => {
                const item = document.createElement('div');
                item.className = 'sequence-item';
                
                if (atelier.type === 'shooting') {
                    item.classList.add('shooting');
                }
                
                const atelierName = atelier.type === 'exercise' 
                    ? `${atelier.name} (Exercice ${atelier.number})`
                    : `🎯 TIR LASER (Session ${atelier.session})`;
                
                const duration = state.exerciseTime + 's';
                const withPause = index < state.sequence.length - 1 
                    ? ` + ${state.pauseTime}s pause` 
                    : '';
                
                // Obtenir l'URL de la démo pour cet exercice
                const demoUrl = atelier.type === 'exercise' ? EXERCISE_DEMOS_N[normExName(atelier.name)] : null;
                const demoImg = demoUrl 
                    ? `<img src="${demoUrl}" alt="${atelierName}" style="width: 80px; height: 80px; object-fit: cover; border-radius: 10px; margin-right: 15px;" onerror="this.style.display='none'">` 
                    : '';
                
                item.innerHTML = `
                    <div style="display: flex; align-items: center; width: 100%;">
                        ${demoImg}
                        <div style="flex: 1;">
                            <div style="display: flex; align-items: center; justify-content: space-between;">
                                <div style="display: flex; align-items: center; gap: 15px;">
                                    <div class="sequence-number">${index + 1}</div>
                                    <div class="sequence-name">${atelierName}</div>
                                </div>
                                <div class="sequence-duration">${duration}${withPause}</div>
                                <div style="display:flex; gap:8px; margin-left:12px;">
                                    <button class="btn btn-secondary" style="padding:6px 10px; min-width:auto;" onclick="moveAtelierUp(${index})" ${index===0?'disabled':''} title="Monter">⬆️</button>
                                    <button class="btn btn-secondary" style="padding:6px 10px; min-width:auto;" onclick="moveAtelierDown(${index})" ${index===state.sequence.length-1?'disabled':''} title="Descendre">⬇️</button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                sequenceDiv.appendChild(item);
            });
            
            // Afficher le récapitulatif, masquer la session en cours
            document.getElementById('recapSection').classList.remove('hidden');
            document.getElementById('sessionInProgress').classList.add('hidden');
        }
        
        function backToConfig() {
            // Revenir à l'écran de configuration
            document.getElementById('sessionScreen').classList.add('hidden');
            document.getElementById('configScreen').classList.remove('hidden');
            
            // Réinitialiser l'affichage du récapitulatif pour la prochaine fois
            document.getElementById('recapSection').classList.remove('hidden');
            document.getElementById('sessionInProgress').classList.add('hidden');
        }
        
        function startTotalTimer() {
            state.totalTimeRunning = true;
            document.getElementById('totalTimerContainer').classList.add('hidden'); // Masquer le chrono en haut
            state.totalTimeInterval = setInterval(() => {
                state.totalTime++;
                const minutes = Math.floor(state.totalTime / 60);
                const seconds = state.totalTime % 60;
                const timeStr = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                // Mettre à jour l'ancien chrono (au cas où)
                document.getElementById('totalTimeDisplay').textContent = timeStr;
                
                // Mettre à jour le bouton rond avec le chronomètre
                updateButtonTimer(timeStr);
            }, 1000);
        }
        
        function updateButtonTimer(timeStr) {
            const button = document.getElementById('startTabataButton');
            const currentAtelier = state.currentSequenceIndex + 1;
            const totalAteliers = state.sequence.length;
            
            // Afficher le chronomètre dans le bouton quand il tourne
            if (state.tabataRunning) {
                button.innerHTML = `
                    <div style="font-size: 2rem; font-weight: 900;">${timeStr}</div>
                    <div style="font-size: 0.9rem; margin-top: 5px;">Atelier ${currentAtelier}/${totalAteliers}</div>
                `;
            }
        }
        
        function startGlobalSession() {
            // Masquer le récapitulatif et afficher la session en cours
            document.getElementById('recapSection').classList.add('hidden');
            document.getElementById('sessionInProgress').classList.remove('hidden');
            
            // Afficher le premier atelier
            showCurrentAtelier();
            
            // NE PAS démarrer automatiquement - l'utilisateur doit cliquer sur le bouton
            // pour avoir le temps de configurer (ex: distance de tir)
        }
        
        function stopTotalTimer() {
            state.totalTimeRunning = false;
            clearInterval(state.totalTimeInterval);
        }
        
        function showCurrentAtelier() {
            if (state.currentSequenceIndex >= state.sequence.length) {
                stopTotalTimer();
                showResults();
                return;
            }
            
            const atelier = state.sequence[state.currentSequenceIndex];
            
            state.currentReps = 0;
            state.currentHits = 0;
            state.tabataTime = state.exerciseTime;
            state.isInWorkPhase = true;
            state.tabataRunning = false;
            
            // Réinitialiser l'apparence du chronomètre général si pas encore démarré
            if (!state.totalTimeRunning) {
                document.getElementById('totalTimerContainer').classList.add('waiting');
                document.getElementById('totalTimeDisplay').textContent = '00:00';
            }
            
            document.getElementById('atelierProgress').textContent = 
                `Atelier ${state.currentSequenceIndex + 1} / ${state.sequence.length}`;
            
            if (atelier.type === 'exercise') {
                document.getElementById('currentAtelierName').textContent = atelier.name;
                document.getElementById('repCounter').textContent = '0';
                document.getElementById('currentPoints').textContent = '0 pts';
                document.getElementById('repSection').classList.remove('hidden');
                document.getElementById('shootingSection').classList.add('hidden');
                
                const instructions = EXERCISE_INSTRUCTIONS_N[normExName(atelier.name)];
                document.getElementById('atelierInstructions').innerHTML = `
                    <div class="instructions-title">${instructions.title} - Exercice ${atelier.number}</div>
                    <div class="instructions-text">${instructions.text}</div>
                `;
            } else {
                document.getElementById('currentAtelierName').textContent = '🎯 TIR LASER';
                document.getElementById('hitsCounter').textContent = '0';
                document.getElementById('currentShootingPoints').textContent = '0 pts';
                document.getElementById('repSection').classList.add('hidden');
                document.getElementById('shootingSection').classList.remove('hidden');
                
                document.getElementById('atelierInstructions').innerHTML = `
                    <div class="instructions-title">🎯 Consignes de tir - Session ${atelier.session}</div>
                    <div class="instructions-text">
                        Tir à 1 bras. Toute la série sera réalisée à la distance choisie (3m, 5m ou 8m).<br>
                        Le coach compte chaque tir réussi en cliquant sur +1.
                    </div>
                `;
            }
            
            updateTabataDisplay(state.exerciseTime);
            updateTabataPhase('EXERCICE', 'tabata-phase work');
            document.getElementById('tabataPhase').className = 'tabata-phase work';
            removeTabataWarning();
            
            // Si c'est le premier atelier et que le chrono n'a pas encore démarré, VERROUILLER
            if (!state.totalTimeRunning) {
                const repButtons = document.querySelectorAll('#repSection .btn-counter');
                repButtons.forEach(btn => btn.disabled = true);
                
                const shootingButtons = document.querySelectorAll('#shootingSection .btn-counter');
                shootingButtons.forEach(btn => btn.disabled = true);
                
                document.getElementById('repSection').style.opacity = '0.5';
                document.getElementById('shootingSection').style.opacity = '0.5';
            } else {
                // Sinon, déverrouiller (cas des ateliers suivants)
                const repButtons = document.querySelectorAll('#repSection .btn-counter');
                repButtons.forEach(btn => btn.disabled = false);
                
                const shootingButtons = document.querySelectorAll('#shootingSection .btn-counter');
                shootingButtons.forEach(btn => btn.disabled = false);
                
                document.getElementById('repSection').style.opacity = '1';
                document.getElementById('shootingSection').style.opacity = '1';
            }
            
            // Toujours afficher le bouton pour que l'utilisateur puisse démarrer
            document.getElementById('startTabataButton').classList.remove('hidden');
            document.getElementById('startTabataButton').innerHTML = '<span>▶️ Démarrer</span>';
        }
        
        function startTabata() {
            if (state.tabataRunning) {
                pauseTabata();
            } else {
                // Si on attend le prochain coureur en mode équipe
                if (state.waitingForNextRunner) {
                    state.waitingForNextRunner = false;
                    actuallyStartTabata();
                }
                // Si le chronomètre général n'est pas encore lancé, faire un compte à rebours de 5s
                // (Premier coureur uniquement)
                else if (!state.totalTimeRunning) {
                    startCountdown();
                } else {
                    // Le chrono général tourne déjà, démarrer directement
                    actuallyStartTabata();
                }
            }
        }
        
        function startCountdown() {
            let countdown = 5;
            
            // VERROUILLER les boutons de comptage pendant le compte à rebours
            const repButtons = document.querySelectorAll('#repSection .btn-counter');
            repButtons.forEach(btn => btn.disabled = true);
            
            const shootingButtons = document.querySelectorAll('#shootingSection .btn-counter');
            shootingButtons.forEach(btn => btn.disabled = true);
            
            // Réduire l'opacité pour montrer que c'est verrouillé
            document.getElementById('repSection').style.opacity = '0.5';
            document.getElementById('shootingSection').style.opacity = '0.5';
            
            // Désactiver le bouton pendant le compte à rebours
            const button = document.getElementById('startTabataButton');
            button.disabled = true;
            button.innerHTML = `
                <div class="circular-start-countdown">${countdown}</div>
                <div class="circular-start-countdown-label">Préparation</div>
            `;
            
            // Afficher le compte à rebours dans le chronomètre Tabata aussi
            updateTabataDisplay(countdown);
            updateTabataPhase('PRÉPARATION', 'tabata-phase rest');
            document.getElementById('tabataPhase').className = 'tabata-phase rest';
            
            const countdownInterval = setInterval(() => {
                countdown--;
                button.innerHTML = `
                    <div class="circular-start-countdown">${countdown}</div>
                    <div class="circular-start-countdown-label">Préparation</div>
                `;
                updateTabataDisplay(countdown);
                
                if (countdown <= 0) {
                    clearInterval(countdownInterval);
                    
                    // Démarrer le chronomètre général
                    startTotalTimer();
                    
                    // DÉVERROUILLER les boutons de comptage
                    repButtons.forEach(btn => btn.disabled = false);
                    shootingButtons.forEach(btn => btn.disabled = false);
                    document.getElementById('repSection').style.opacity = '1';
                    document.getElementById('shootingSection').style.opacity = '1';
                    
                    // Réinitialiser l'affichage et démarrer le Tabata
                    updateTabataPhase('EXERCICE', 'tabata-phase work');
                    document.getElementById('tabataPhase').className = 'tabata-phase work';
                    button.disabled = false;
                    button.innerHTML = `
                        <div class="circular-start-icon">⏸️</div>
                        <div class="circular-start-text">PAUSE</div>
                    `;
                    
                    actuallyStartTabata();
                }
            }, 1000);
        }
        
        function actuallyStartTabata() {
            state.tabataRunning = true;
            
            // Mettre à jour le bouton avec le chronomètre
            const minutes = Math.floor(state.totalTime / 60);
            const seconds = state.totalTime % 60;
            const timeStr = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            const currentAtelier = state.currentSequenceIndex + 1;
            const totalAteliers = state.sequence.length;
            
            const button = document.getElementById('startTabataButton');
            button.innerHTML = `
                <div class="circular-start-timer">${timeStr}</div>
                <div class="circular-start-round">Round ${currentAtelier} of ${totalAteliers}</div>
            `;
            
            // Jouer le bip de démarrage
            playBeep('start');
            
            state.tabataInterval = setInterval(() => {
                state.tabataTime--;
                updateTabataDisplay(state.tabataTime);
                
                if (state.tabataTime <= 10 && state.isInWorkPhase) {
                    addTabataWarning();
                }
                
                if (state.tabataTime <= 0) {
                    if (state.isInWorkPhase) {
                        endWorkPhase();
                    } else {
                        endRestPhase();
                    }
                }
            }, 1000);
        }
        
        function pauseTabata() {
            state.tabataRunning = false;
            clearInterval(state.tabataInterval);
            
            const minutes = Math.floor(state.totalTime / 60);
            const seconds = state.totalTime % 60;
            const timeStr = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            const currentAtelier = state.currentSequenceIndex + 1;
            const totalAteliers = state.sequence.length;
            
            const button = document.getElementById('startTabataButton');
            button.innerHTML = `
                <div style="width: 0; height: 0; border-left: 80px solid white; border-top: 50px solid transparent; border-bottom: 50px solid transparent; filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.4)); margin-left: 20px; margin-bottom: 5px;"></div>
                <div class="circular-start-text">REPRENDRE</div>
                <div class="circular-start-round" style="margin-top: 8px; font-size: 0.9rem;">${timeStr} • Round ${currentAtelier}/${totalAteliers}</div>
            `;
        }
        
        function endWorkPhase() {
            pauseTabata();
            
            // Jouer le bip de fin d'exercice
            playBeep('end');
            
            const atelier = state.sequence[state.currentSequenceIndex];
            
            if (atelier.type === 'exercise') {
                const points = calculateExercisePoints(atelier.name, state.currentReps);
                state.results.push({
                    type: 'exercise',
                    name: `${atelier.name} (Exercice ${atelier.number})`,
                    reps: state.currentReps,
                    totalPoints: points
                });
            } else {
                const distance = parseInt(document.getElementById('shootingDistance').value);
                const pointsPerHit = SHOOTING_POINTS[distance];
                const points = state.currentHits * pointsPerHit;
                
                state.results.push({
                    type: 'shooting',
                    name: `Tir laser Session ${atelier.session} à ${distance}m`,
                    hits: state.currentHits,
                    pointsPerHit: pointsPerHit,
                    totalPoints: points
                });
            }
            
            // Passer immédiatement à l'atelier suivant
            state.currentSequenceIndex++;
            
            // Vérifier s'il y a un atelier suivant
            if (state.currentSequenceIndex >= state.sequence.length) {
                // Plus d'ateliers, afficher directement les résultats (pas de pause)
                stopTotalTimer();
                showResults();
                return;
            }
            
            // Afficher l'atelier suivant en mode pause
            const nextAtelier = state.sequence[state.currentSequenceIndex];
            
            // Réinitialiser les compteurs pour le nouvel atelier
            state.currentReps = 0;
            state.currentHits = 0;
            
            // Afficher le contenu du nouvel atelier
            document.getElementById('atelierProgress').textContent = 
                `Atelier ${state.currentSequenceIndex + 1} / ${state.sequence.length} - ⏸️ PAUSE`;
            
            if (nextAtelier.type === 'exercise') {
                document.getElementById('currentAtelierName').textContent = nextAtelier.name;
                document.getElementById('repCounter').textContent = '0';
                document.getElementById('currentPoints').textContent = '0 pts';
                document.getElementById('repSection').classList.remove('hidden');
                document.getElementById('shootingSection').classList.add('hidden');
                
                const instructions = EXERCISE_INSTRUCTIONS_N[normExName(nextAtelier.name)];
                document.getElementById('atelierInstructions').innerHTML = `
                    <div class="instructions-title">${instructions.title} - Exercice ${nextAtelier.number}</div>
                    <div class="instructions-text">${instructions.text}</div>
                `;
                
                // Verrouiller les boutons pendant la pause
                const repButtons = document.querySelectorAll('#repSection .btn-counter');
                repButtons.forEach(btn => btn.disabled = true);
                document.getElementById('repSection').style.opacity = '0.5';
            } else {
                document.getElementById('currentAtelierName').textContent = '🎯 TIR LASER';
                document.getElementById('hitsCounter').textContent = '0';
                document.getElementById('currentShootingPoints').textContent = '0 pts';
                document.getElementById('repSection').classList.add('hidden');
                document.getElementById('shootingSection').classList.remove('hidden');
                
                document.getElementById('atelierInstructions').innerHTML = `
                    <div class="instructions-title">🎯 Consignes de tir - Session ${nextAtelier.session}</div>
                    <div class="instructions-text">
                        Tir à 1 bras. Toute la série sera réalisée à la distance choisie (3m, 5m ou 8m).<br>
                        Le coach compte chaque tir réussi en cliquant sur +1.<br><br>
                        <strong>Vous pouvez configurer la distance pendant la pause !</strong>
                    </div>
                `;
                
                // Pour le tir, on peut changer la distance pendant la pause mais pas compter
                const shootingButtons = document.querySelectorAll('#shootingSection .btn-counter');
                shootingButtons.forEach(btn => btn.disabled = true);
                document.getElementById('shootingSection').style.opacity = '0.7';
                // Le sélecteur de distance reste actif
                document.getElementById('shootingDistance').disabled = false;
            }
            
            // Configuration de la pause
            state.isInWorkPhase = false;
            state.tabataTime = state.pauseTime;
            updateTabataDisplay(state.pauseTime);
            removeTabataWarning();
            updateTabataPhase('PAUSE', 'tabata-phase rest');
            document.getElementById('tabataPhase').className = 'tabata-phase rest';
            document.getElementById('startTabataButton').classList.add('hidden');
            
            // Démarrer le compte à rebours de la pause
            state.tabataRunning = true;
            state.tabataInterval = setInterval(() => {
                state.tabataTime--;
                updateTabataDisplay(state.tabataTime);
                
                if (state.tabataTime <= 0) {
                    endRestPhase();
                }
            }, 1000);
        }
        
        function endRestPhase() {
            pauseTabata();
            
            // Vérifier si c'était la pause finale
            if (state.currentSequenceIndex >= state.sequence.length) {
                // Afficher les résultats
                stopTotalTimer();
                showResults();
                return;
            }
            
            // L'atelier suivant est déjà affiché, il suffit de déverrouiller et démarrer
            // Déverrouiller les boutons de comptage
            const repButtons = document.querySelectorAll('#repSection .btn-counter');
            repButtons.forEach(btn => btn.disabled = false);
            
            const shootingButtons = document.querySelectorAll('#shootingSection .btn-counter');
            shootingButtons.forEach(btn => btn.disabled = false);
            
            // Rétablir l'opacité normale
            document.getElementById('repSection').style.opacity = '1';
            document.getElementById('shootingSection').style.opacity = '1';
            
            // Réinitialiser le Tabata pour le nouvel exercice
            state.isInWorkPhase = true;
            state.tabataTime = state.exerciseTime;
            updateTabataDisplay(state.exerciseTime);
            updateTabataPhase('EXERCICE', 'tabata-phase work');
            document.getElementById('tabataPhase').className = 'tabata-phase work';
            
            // Mettre à jour l'affichage de progression (retirer "PAUSE")
            document.getElementById('atelierProgress').textContent = 
                `Atelier ${state.currentSequenceIndex + 1} / ${state.sequence.length}`;
            
            // Démarrer automatiquement le chronomètre du nouvel atelier
            actuallyStartTabata();
        }
        
        function nextAtelier() {
            state.currentSequenceIndex++;
            showCurrentAtelier();
            
            // Démarrer automatiquement le chronomètre
            startTabata();
        }
        
        function incrementReps() {
            vibrate(); // Retour haptique
            state.currentReps++;
            document.getElementById('repCounter').textContent = state.currentReps;
            updateExercisePoints();
        }
        
        function decrementReps() {
            if (state.currentReps > 0) {
                vibrate(); // Retour haptique
                state.currentReps--;
                document.getElementById('repCounter').textContent = state.currentReps;
                updateExercisePoints();
            }
        }
        
        function updateExercisePoints() {
            const atelier = state.sequence[state.currentSequenceIndex];
            if (atelier && atelier.type === 'exercise') {
                const points = calculateExercisePoints(atelier.name, state.currentReps);
                // Afficher avec 1 décimale si nécessaire
                const displayPoints = points % 1 === 0 ? points.toFixed(0) : points.toFixed(1);
                document.getElementById('currentPoints').textContent = displayPoints + ' pts';
            }
        }
        
        function incrementHits() {
            vibrate(); // Retour haptique
            state.currentHits++;
            document.getElementById('hitsCounter').textContent = state.currentHits;
            updateShootingPoints();
        }
        
        function decrementHits() {
            if (state.currentHits > 0) {
                vibrate(); // Retour haptique
                state.currentHits--;
                document.getElementById('hitsCounter').textContent = state.currentHits;
                updateShootingPoints();
            }
        }
        
        function updateShootingPoints() {
            const distance = parseInt(document.getElementById('shootingDistance').value);
            const pointsPerHit = SHOOTING_POINTS[distance];
            const points = state.currentHits * pointsPerHit;
            document.getElementById('currentShootingPoints').textContent = points + ' pts';
        }
        
        // ============================================
        // SYSTÈME DE BADGES
        // ============================================
        
        const BADGES = {
            firstSession: {
                id: 'firstSession',
                icon: '🎉',
                name: 'Première séance',
                description: 'Bienvenue !',
                condition: (data) => true // Toujours obtenu
            },
            sharpshooter: {
                id: 'sharpshooter',
                icon: '🎯',
                name: 'Tireur d\'élite',
                description: '15+ tirs réussis',
                condition: (data) => {
                    const shootingResults = data.results.filter(r => r.type === 'shooting');
                    return shootingResults.some(r => r.hits >= 15);
                }
            },
            ironMan: {
                id: 'ironMan',
                icon: '💪',
                name: 'Iron Athlete',
                description: '50+ répétitions',
                condition: (data) => {
                    const exerciseResults = data.results.filter(r => r.type === 'exercise');
                    return exerciseResults.some(r => r.reps >= 50);
                }
            },
            perfectScore: {
                id: 'perfectScore',
                icon: '⭐',
                name: 'Score parfait',
                description: '50 pts sur un exercice',
                condition: (data) => {
                    return data.results.some(r => r.totalPoints >= 50);
                }
            },
            champion: {
                id: 'champion',
                icon: '🏆',
                name: 'Champion',
                description: '100+ points total',
                condition: (data) => {
                    const total = data.results.reduce((sum, r) => sum + r.totalPoints, 0);
                    return total >= 100;
                }
            },
            sniper: {
                id: 'sniper',
                icon: '🔫',
                name: 'Sniper',
                description: 'Tir à 8m réussi',
                condition: (data) => {
                    const shootingResults = data.results.filter(r => r.type === 'shooting');
                    return shootingResults.some(r => r.name && r.name.includes('8m') && r.hits > 0);
                }
            },
            endurance: {
                id: 'endurance',
                icon: '🔥',
                name: 'Endurance',
                description: '5+ ateliers complétés',
                condition: (data) => {
                    return data.results.length >= 5;
                }
            }
        };
        
        function checkBadges(sessionData) {
            const earnedBadges = [];
            
            for (const [key, badge] of Object.entries(BADGES)) {
                if (badge.condition(sessionData)) {
                    earnedBadges.push(badge);
                }
            }
            
            return earnedBadges;
        }
        
        function displayBadges(badges) {
            const container = document.getElementById('badgesContainer');
            
            if (badges.length === 0) {
                container.innerHTML = '<p style="color: var(--text-dim); text-align: center;">Aucun badge obtenu cette fois. Continue tes efforts ! 💪</p>';
                return;
            }
            
            container.innerHTML = '';
            badges.forEach((badge, index) => {
                const badgeEl = document.createElement('div');
                badgeEl.className = 'badge-item';
                badgeEl.style.animationDelay = `${index * 0.1}s`;
                badgeEl.innerHTML = `
                    <div class="badge-icon">${badge.icon}</div>
                    <div class="badge-name">${badge.name}</div>
                    <div class="badge-desc">${badge.description}</div>
                `;
                container.appendChild(badgeEl);
            });
        }
        
        // ============================================
        // GRAPHIQUE DE PROGRESSION DU TIR
        // ============================================
        
        function createShootingProgressChart(results) {
            const shootingResults = results.filter(r => r.type === 'shooting');
            
            if (shootingResults.length < 2) {
                // Pas assez de sessions de tir pour un graphique
                document.getElementById('shootingProgressChart').classList.add('hidden');
                return;
            }
            
            document.getElementById('shootingProgressChart').classList.remove('hidden');
            
            const canvas = document.getElementById('shootingChart');
            const ctx = canvas.getContext('2d');
            
            // Tailles
            const width = canvas.width = canvas.offsetWidth * 2; // Retina
            const height = canvas.height = 500;
            const padding = 60;
            const chartWidth = width - padding * 2;
            const chartHeight = height - padding * 2;
            
            // Données
            const labels = shootingResults.map((r, i) => `Session ${i + 1}`);
            const hitsData = shootingResults.map(r => r.hits);
            const pointsData = shootingResults.map(r => r.totalPoints);
            const maxHits = Math.max(...hitsData);
            const maxPoints = Math.max(...pointsData);
            
            // Couleurs selon le thème
            const primaryColor = getComputedStyle(document.documentElement).getPropertyValue('--primary').trim();
            const secondaryColor = getComputedStyle(document.documentElement).getPropertyValue('--secondary').trim();
            
            // Fond
            ctx.fillStyle = getComputedStyle(document.querySelector('.card')).backgroundColor;
            ctx.fillRect(0, 0, width, height);
            
            // Grille
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
            ctx.lineWidth = 1;
            for (let i = 0; i <= 5; i++) {
                const y = padding + (chartHeight / 5) * i;
                ctx.beginPath();
                ctx.moveTo(padding, y);
                ctx.lineTo(width - padding, y);
                ctx.stroke();
            }
            
            // Axes
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(padding, padding);
            ctx.lineTo(padding, height - padding);
            ctx.lineTo(width - padding, height - padding);
            ctx.stroke();
            
            // Barres
            const barWidth = chartWidth / shootingResults.length / 2.5;
            const spacing = chartWidth / shootingResults.length;
            
            shootingResults.forEach((result, index) => {
                const x = padding + spacing * index + spacing / 2 - barWidth;
                
                // Barre tirs (en secondaire)
                const hitsHeight = (result.hits / maxHits) * chartHeight;
                const hitsY = height - padding - hitsHeight;
                
                const gradient1 = ctx.createLinearGradient(0, hitsY, 0, height - padding);
                gradient1.addColorStop(0, secondaryColor);
                gradient1.addColorStop(1, secondaryColor + '80');
                
                ctx.fillStyle = gradient1;
                ctx.fillRect(x, hitsY, barWidth * 0.8, hitsHeight);
                
                // Texte tirs
                ctx.fillStyle = secondaryColor;
                ctx.font = 'bold 24px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(result.hits, x + barWidth * 0.4, hitsY - 10);
                
                // Barre points (en primary)
                const pointsHeight = (result.totalPoints / maxPoints) * chartHeight;
                const pointsY = height - padding - pointsHeight;
                
                const gradient2 = ctx.createLinearGradient(0, pointsY, 0, height - padding);
                gradient2.addColorStop(0, primaryColor);
                gradient2.addColorStop(1, primaryColor + '80');
                
                ctx.fillStyle = gradient2;
                ctx.fillRect(x + barWidth * 0.9, pointsY, barWidth * 0.8, pointsHeight);
                
                // Texte points
                ctx.fillStyle = primaryColor;
                ctx.fillText(result.totalPoints + 'pts', x + barWidth * 1.3, pointsY - 10);
                
                // Label session
                ctx.fillStyle = 'var(--text)';
                ctx.font = '20px Arial';
                ctx.fillText(labels[index], x + barWidth, height - padding + 35);
            });
            
            // Légende
            ctx.font = 'bold 22px Arial';
            ctx.fillStyle = secondaryColor;
            ctx.fillRect(padding, 20, 30, 30);
            ctx.fillStyle = 'var(--text)';
            ctx.textAlign = 'left';
            ctx.fillText('Tirs réussis', padding + 40, 43);
            
            ctx.fillStyle = primaryColor;
            ctx.fillRect(padding + 200, 20, 30, 30);
            ctx.fillStyle = 'var(--text)';
            ctx.fillText('Points', padding + 240, 43);
        }
        
        // ============================================
        // SYSTÈME DE CLASSEMENT
        // ============================================
        
        function saveToLeaderboard(sessionData) {
            // Récupérer le classement existant
            let leaderboard = JSON.parse(localStorage.getItem('laserfit-leaderboard') || '[]');
            
            // Calculer les totaux
            const exercisePoints = sessionData.results
                .filter(r => r.type === 'exercise')
                .reduce((sum, r) => sum + r.totalPoints, 0);
            
            const shootingPoints = sessionData.results
                .filter(r => r.type === 'shooting')
                .reduce((sum, r) => sum + r.totalPoints, 0);
            
            const totalPoints = exercisePoints + shootingPoints;
            
            // Ajouter l'entrée
            leaderboard.push({
                date: sessionData.sessionDate,
                time: sessionData.sessionTime,
                studentName: sessionData.studentName,
                className: sessionData.className,
                groupName: sessionData.groupName || '',
                exercisePoints: exercisePoints,
                shootingPoints: shootingPoints,
                totalPoints: totalPoints
            });
            
            // Sauvegarder
            localStorage.setItem('laserfit-leaderboard', JSON.stringify(leaderboard));
        }
        
        function showLeaderboard() {
            const leaderboard = JSON.parse(localStorage.getItem('laserfit-leaderboard') || '[]');
            
            if (leaderboard.length === 0) {
                alert('Aucune donnée de classement pour le moment. Complète des séances pour apparaître dans le classement !');
                return;
            }
            
            // Filtrer par classe actuelle
            const currentClass = state.className;
            const classData = leaderboard.filter(entry => entry.className === currentClass);
            
            if (classData.length === 0) {
                alert(`Aucune donnée pour la classe "${currentClass}". Le classement se construit au fur et à mesure des séances.`);
                return;
            }
            
            // Calculer les classements
            const byExercise = [...classData].sort((a, b) => b.exercisePoints - a.exercisePoints);
            const byShooting = [...classData].sort((a, b) => b.shootingPoints - a.shootingPoints);
            const byTotal = [...classData].sort((a, b) => b.totalPoints - a.totalPoints);
            
            // Créer le modal de classement
            showLeaderboardModal(byExercise, byShooting, byTotal, currentClass);
        }
        
        function showLeaderboardModal(byExercise, byShooting, byTotal, className) {
            // Créer le modal
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 700px;">
                    <div class="modal-header">
                        <h2>🏅 Classement de la classe ${className}</h2>
                        <button class="close-btn" onclick="this.closest('.modal').remove()">✕</button>
                    </div>
                    
                    <div class="modal-body">
                        <div style="margin-bottom: 30px;">
                            <h3 style="color: var(--secondary); margin-bottom: 15px;">💪 Classement Exercices</h3>
                            ${generateLeaderboardTable(byExercise.slice(0, 10), 'exercisePoints')}
                        </div>
                        
                        <div style="margin-bottom: 30px;">
                            <h3 style="color: var(--tertiary); margin-bottom: 15px;">🎯 Classement Tir Laser</h3>
                            ${generateLeaderboardTable(byShooting.slice(0, 10), 'shootingPoints')}
                        </div>
                        
                        <div>
                            <h3 style="color: var(--primary); margin-bottom: 15px;">🏆 Classement Général</h3>
                            ${generateLeaderboardTable(byTotal.slice(0, 10), 'totalPoints')}
                        </div>
                    </div>
                    
                    <div class="modal-footer">
                        <button class="btn btn-secondary btn-full" onclick="clearLeaderboard()">
                            <span>🗑️ Réinitialiser le classement</span>
                        </button>
                        <button class="btn btn-primary btn-full" onclick="this.closest('.modal').remove()" style="margin-top: 10px;">
                            <span>Fermer</span>
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
        
        function generateLeaderboardTable(data, pointsField) {
            if (data.length === 0) {
                return '<p style="color: var(--text-dim); text-align: center;">Aucune donnée disponible</p>';
            }
            
            const medals = ['🥇', '🥈', '🥉'];
            
            return `
                <div style="overflow-x: auto;">
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="border-bottom: 2px solid var(--secondary);">
                                <th style="padding: 12px; text-align: left; color: var(--text);">Rang</th>
                                <th style="padding: 12px; text-align: left; color: var(--text);">Pratiquant</th>
                                <th style="padding: 12px; text-align: right; color: var(--text);">Points</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${data.map((entry, index) => `
                                <tr style="border-bottom: 1px solid rgba(255, 255, 255, 0.1); ${entry.studentName === state.studentName ? 'background: rgba(0, 255, 204, 0.1);' : ''}">
                                    <td style="padding: 12px; color: var(--text);">
                                        ${index < 3 ? medals[index] : `${index + 1}.`}
                                    </td>
                                    <td style="padding: 12px; color: var(--text); font-weight: ${entry.studentName === state.studentName ? 'bold' : 'normal'};">
                                        ${entry.studentName}${entry.studentName === state.studentName ? ' (Toi)' : ''}
                                    </td>
                                    <td style="padding: 12px; text-align: right; color: var(--secondary); font-weight: bold;">
                                        ${entry[pointsField]} pts
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }
        
        function clearLeaderboard() {
            if (confirm('⚠️ Voulez-vous vraiment effacer tout le classement ? Cette action est irréversible !')) {
                localStorage.removeItem('laserfit-leaderboard');
                alert('✅ Classement réinitialisé avec succès !');
                document.querySelector('.modal').remove();
            }
        }
        
        // ============================================
        // MODE ÉQUIPE - NAVIGATION
        // ============================================
        
        function selectInitialMode(mode) {
            state.gameMode = mode;
            
            // Cacher l'écran de sélection initial
            document.getElementById('initialModeScreen').classList.add('hidden');
            
            if (mode === 'solo') {
                // Mode solo : aller à l'écran Info
                document.getElementById('infoScreen').classList.remove('hidden');
            } else {
                // Mode équipe : aller directement à la config des équipes
                document.getElementById('teamSetupScreen').classList.remove('hidden');
                setTeamCount(1); // Par défaut 1 équipe
            }
        }
        
        function goToModeSelection() {
            const studentName = document.getElementById('studentName').value.trim();
            const observerName = document.getElementById('observerName').value.trim();
            const className = document.getElementById('className').value.trim();
            const sessionDate = document.getElementById('sessionDate').value;
            const sessionTime = document.getElementById('sessionTime').value;
            
            if (!studentName || !observerName || !className || !sessionDate || !sessionTime) {
                alert('Veuillez remplir tous les champs obligatoires avant de continuer.');
                return;
            }
            
            state.studentName = studentName;
            state.observerName = observerName;
            state.className = className;
            state.groupName = document.getElementById('groupName').value.trim();
            state.sessionDate = sessionDate;
            state.sessionTime = sessionTime;
            
            // En mode solo, aller directement à la config
            document.getElementById('infoScreen').classList.add('hidden');
            document.getElementById('configScreen').classList.remove('hidden');
            
            // Afficher les tirs dans la liste automatiquement
            updateExerciseList();
        }
        
        function backToInfo() {
            // Retour impossible, on ne peut pas changer de mode
            // On retourne à l'écran initial
            if (confirm('Revenir à la sélection du mode ? Les données seront perdues.')) {
                resetApp();
            }
        }
        
        function backToModeSelection() {
            if (confirm('Revenir au choix du mode ? Les données des équipes seront perdues.')) {
                document.getElementById('teamSetupScreen').classList.add('hidden');
                document.getElementById('configScreen').classList.add('hidden');
                resetApp();
            }
        }
        
        // ============================================
        // MODE ÉQUIPE - CONFIGURATION
        // ============================================
        
        function setTeamCount(count) {
            // Désactiver tous les boutons
            for (let i = 1; i <= 4; i++) {
                const btn = document.getElementById(`teamCount${i}`);
                if (btn) {
                    btn.style.background = 'rgba(255, 255, 255, 0.1)';
                    btn.style.borderColor = 'rgba(255, 255, 255, 0.3)';
                }
            }
            
            // Activer le bouton sélectionné
            const activeBtn = document.getElementById(`teamCount${count}`);
            activeBtn.style.background = 'var(--secondary)';
            activeBtn.style.borderColor = 'var(--secondary)';
            activeBtn.style.color = 'var(--bg-dark)';
            
            // Initialiser les équipes
            state.teams = [];
            for (let i = 0; i < count; i++) {
                state.teams.push({
                    id: i,
                    name: TEAM_COLORS[i].name,
                    emoji: TEAM_COLORS[i].emoji,
                    color: TEAM_COLORS[i].color,
                    border: TEAM_COLORS[i].border,
                    members: [],
                    totalScore: 0,
                    completedRunners: 0
                });
            }
            
            renderTeamsSetup();
        }
        
        function renderTeamsSetup() {
            const container = document.getElementById('teamsContainer');
            container.innerHTML = '';
            
            state.teams.forEach((team, teamIndex) => {
                const teamCard = document.createElement('div');
                teamCard.className = 'team-card';
                teamCard.style.borderColor = team.border;
                
                let membersHTML = '';
                team.members.forEach((member, memberIndex) => {
                    membersHTML += `
                        <div class="team-member">
                            <span class="team-member-name">${member}</span>
                            <button onclick="removeMember(${teamIndex}, ${memberIndex})" style="background: var(--danger); border: none; color: white; padding: 5px 10px; border-radius: 5px; cursor: pointer;">✕</button>
                        </div>
                    `;
                });
                
                // En mode 1 équipe, permettre de changer le nom et la couleur
                let teamNameHTML = '';
                if (state.teams.length === 1) {
                    teamNameHTML = `
                        <div style="margin-bottom: 20px; padding: 15px; background: rgba(0, 255, 204, 0.1); border-radius: 8px; border-left: 4px solid var(--secondary);">
                            <label style="display: block; font-weight: 600; margin-bottom: 10px; color: var(--text);">
                                🏷️ Nom de l'équipe (personnalisable)
                            </label>
                            <input type="text" id="teamName-${teamIndex}" value="${team.name}" 
                                   onchange="updateTeamName(${teamIndex}, this.value)"
                                   style="width: 100%; padding: 10px; background: rgba(255, 255, 255, 0.1); border: 2px solid ${team.border}; border-radius: 8px; color: var(--text); font-size: 1.1rem; font-weight: 600;">
                            
                            <label style="display: block; font-weight: 600; margin-top: 15px; margin-bottom: 10px; color: var(--text);">
                                🎨 Couleur de l'équipe
                            </label>
                            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                                ${TEAM_COLORS.map((color, idx) => `
                                    <button onclick="changeTeamColor(${teamIndex}, ${idx})" 
                                            style="width: 50px; height: 50px; border-radius: 50%; background: ${color.color}; border: 3px solid ${team.id === idx ? '#FFE66D' : color.border}; cursor: pointer; transition: all 0.2s; box-shadow: ${team.id === idx ? '0 0 0 3px rgba(255, 230, 109, 0.3)' : 'none'};"
                                            title="${color.name}">
                                        ${color.emoji}
                                    </button>
                                `).join('')}
                            </div>
                        </div>
                    `;
                }
                
                teamCard.innerHTML = `
                    ${teamNameHTML}
                    
                    <div class="team-header">
                        <div class="team-name">
                            <span style="font-size: 2rem;">${team.emoji}</span>
                            <span>Équipe ${team.name}</span>
                        </div>
                        <span style="color: var(--text-dim);">${team.members.length} membre(s)</span>
                    </div>
                    
                    <div id="members-${teamIndex}" style="margin-bottom: 15px;">
                        ${membersHTML || '<p style="color: var(--text-dim); font-size: 0.9rem;">Aucun membre ajouté</p>'}
                    </div>
                    
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="newMember-${teamIndex}" placeholder="Nom du membre" style="flex: 1; padding: 10px; background: rgba(255, 255, 255, 0.1); border: 2px solid ${team.border}; border-radius: 8px; color: var(--text);">
                        <button onclick="addMember(${teamIndex})" class="btn btn-secondary" style="padding: 10px 20px;">+ Ajouter</button>
                    </div>
                `;
                
                container.appendChild(teamCard);
            });
        }
        
        function addMember(teamIndex) {
            const input = document.getElementById(`newMember-${teamIndex}`);
            const memberName = input.value.trim();
            
            if (!memberName) {
                alert('Veuillez entrer un nom !');
                return;
            }
            
            state.teams[teamIndex].members.push(memberName);
            input.value = '';
            renderTeamsSetup();
        }
        
        function removeMember(teamIndex, memberIndex) {
            state.teams[teamIndex].members.splice(memberIndex, 1);
            renderTeamsSetup();
        }
        
        function updateTeamName(teamIndex, newName) {
            if (newName && newName.trim()) {
                state.teams[teamIndex].name = newName.trim();
                renderTeamsSetup();
            }
        }
        
        function changeTeamColor(teamIndex, colorIndex) {
            const color = TEAM_COLORS[colorIndex];
            
            // Récupérer le nom actuel du champ texte
            const nameInput = document.getElementById(`teamName-${teamIndex}`);
            const fieldValue = nameInput ? nameInput.value.trim() : '';
            
            // Vérifier si le nom a été personnalisé
            // Si le champ est vide ou égal au nom actuel de l'équipe (qui vient de la couleur par défaut),
            // on utilise le nom de la nouvelle couleur
            const currentTeamName = state.teams[teamIndex].name;
            const oldColorIndex = state.teams[teamIndex].id;
            const oldColorName = (oldColorIndex !== undefined && TEAM_COLORS[oldColorIndex]) ? TEAM_COLORS[oldColorIndex].name : '';
            
            // Utiliser le nom de la nouvelle couleur si :
            // - Le champ est vide, OU
            // - Le nom actuel correspond au nom de l'ancienne couleur (pas personnalisé)
            const shouldUseNewColorName = !fieldValue || fieldValue === oldColorName || fieldValue === currentTeamName;
            
            state.teams[teamIndex].id = colorIndex;
            state.teams[teamIndex].name = shouldUseNewColorName ? color.name : fieldValue;
            state.teams[teamIndex].emoji = color.emoji;
            state.teams[teamIndex].color = color.color;
            state.teams[teamIndex].border = color.border;
            
            renderTeamsSetup();
        }
        
        function startTeamSession() {
            // Vérifier que toutes les équipes ont au moins 1 membre
            const emptyTeams = state.teams.filter(t => t.members.length === 0);
            if (emptyTeams.length > 0) {
                alert('⚠️ Toutes les équipes doivent avoir au moins un membre !');
                return;
            }
            
            // Demander les infos de base pour la séance
            const observerName = prompt('Nom de l\'observateur/coach :');
            if (!observerName || !observerName.trim()) {
                alert('Le nom de l\'observateur est obligatoire.');
                return;
            }
            
            const className = prompt('Classe (ex: 3ème A) :');
            if (!className || !className.trim()) {
                alert('La classe est obligatoire.');
                return;
            }
            
            const groupName = prompt('Groupe (optionnel) :');
            
            // Enregistrer les infos
            state.observerName = observerName.trim();
            state.className = className.trim();
            state.groupName = groupName ? groupName.trim() : '';
            
            // Date et heure automatiques
            const now = new Date();
            state.sessionDate = now.toISOString().split('T')[0];
            state.sessionTime = now.toTimeString().slice(0, 5);
            
            // Générer un ID unique pour ce match
            state.teamMatchId = Date.now();
            
            // Réinitialiser les indices
            state.currentTeamIndex = 0;
            state.currentRunnerIndex = 0;
            
            // Aller à la configuration des exercices
            document.getElementById('teamSetupScreen').classList.add('hidden');
            document.getElementById('configScreen').classList.remove('hidden');
            
            // Afficher les tirs dans la liste automatiquement
            updateExerciseList();
        }
        
        // ============================================
        // MODE ÉQUIPE - GESTION DU RELAIS
        // ============================================
        
        function showTeamRelay() {
            document.getElementById('configScreen').classList.add('hidden');
            document.getElementById('teamRelayScreen').classList.remove('hidden');
            
            updateTeamScoreboard();
            updateCurrentRunner();
        }
        
        function updateTeamScoreboard() {
            const container = document.getElementById('teamScoreboard');
            container.innerHTML = '';
            
            // Trier les équipes par score
            const sortedTeams = [...state.teams].sort((a, b) => b.totalScore - a.totalScore);
            
            sortedTeams.forEach((team, rank) => {
                const progress = (team.completedRunners / team.members.length) * 100;
                const progressBlocks = Math.floor(progress / 10);
                const progressBar = '█'.repeat(progressBlocks) + '░'.repeat(10 - progressBlocks);
                
                const teamDiv = document.createElement('div');
                teamDiv.style.cssText = `
                    background: rgba(255, 255, 255, 0.03);
                    border-left: 5px solid ${team.border};
                    border-radius: 12px;
                    padding: 20px;
                    margin-bottom: 15px;
                `;
                
                teamDiv.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                        <div style="font-size: 1.3rem; font-weight: 700;">
                            ${rank === 0 ? '🥇 ' : rank === 1 ? '🥈 ' : rank === 2 ? '🥉 ' : ''}
                            ${team.emoji} Équipe ${team.name}
                        </div>
                        <div style="font-size: 2rem; font-weight: 900; color: ${team.border};">
                            ${team.totalScore} pts
                        </div>
                    </div>
                    <div style="color: var(--text-dim); font-size: 0.9rem;">
                        Progression : ${progressBar} ${team.completedRunners}/${team.members.length}
                    </div>
                `;
                
                container.appendChild(teamDiv);
            });
        }
        
        function updateCurrentRunner() {
            const team = state.teams[state.currentTeamIndex];
            const runner = team.members[state.currentRunnerIndex];
            
            const container = document.getElementById('currentRunner');
            container.innerHTML = `
                <div style="font-size: 2.5rem; margin-bottom: 10px;">${team.emoji}</div>
                <div style="color: var(--text); font-size: 1.5rem; margin-bottom: 5px;">${runner}</div>
                <div style="color: var(--text-dim); font-size: 1rem;">Équipe ${team.name}</div>
                <div style="color: var(--text-dim); font-size: 0.9rem; margin-top: 10px;">
                    Coureur ${state.currentRunnerIndex + 1}/${team.members.length} de l'équipe
                </div>
            `;
        }
        
        function startCurrentRunner() {
            const team = state.teams[state.currentTeamIndex];
            const runner = team.members[state.currentRunnerIndex];
            
            // Mettre le nom du coureur actuel dans state
            state.studentName = runner;
            state.currentTeam = team;
            
            // Démarrer la séance normalement
            document.getElementById('teamRelayScreen').classList.add('hidden');
            document.getElementById('sessionScreen').classList.remove('hidden');
            
            // Afficher le récapitulatif
            showRecap();
        }
        
        function completeCurrentRunner() {
            const team = state.teams[state.currentTeamIndex];
            const runner = team.members[state.currentRunnerIndex];
            
            console.log('=== COMPLETE CURRENT RUNNER ===');
            console.log('Team:', team.name);
            console.log('Runner:', runner);
            console.log('currentRunnerIndex AVANT:', state.currentRunnerIndex);
            console.log('team.members:', team.members);
            console.log('team.members.length:', team.members.length);
            console.log('team.completedRunners AVANT:', team.completedRunners);
            
            // Calculer le score du coureur
            const runnerScore = state.results.reduce((sum, r) => sum + r.totalPoints, 0);
            
            // Ajouter au score de l'équipe
            team.totalScore += runnerScore;
            team.completedRunners++;
            
            console.log('team.completedRunners APRÈS:', team.completedRunners);
            
            // Sauvegarder le résultat individuel
            const runnerData = {
                matchId: state.teamMatchId,
                teamId: team.id,
                teamName: team.name,
                runnerName: runner,
                runnerIndex: state.currentRunnerIndex,
                score: runnerScore,
                results: state.results,
                date: state.sessionDate,
                time: state.sessionTime,
                className: state.className
            };
            
            // Sauvegarder dans localStorage
            let teamMatches = JSON.parse(localStorage.getItem('laserfit-team-matches') || '[]');
            teamMatches.push(runnerData);
            localStorage.setItem('laserfit-team-matches', JSON.stringify(teamMatches));
            
            // Passer au coureur suivant
            state.currentRunnerIndex++;
            
            console.log('currentRunnerIndex APRÈS++:', state.currentRunnerIndex);
            console.log('Comparaison:', state.currentRunnerIndex, '>=', team.members.length, '=', state.currentRunnerIndex >= team.members.length);
            
            // Si tous les membres de cette équipe ont couru
            if (state.currentRunnerIndex >= team.members.length) {
                console.log('CHANGEMENT ÉQUIPE !');
                state.currentRunnerIndex = 0;
                state.currentTeamIndex++;
            }
            
            console.log('currentTeamIndex:', state.currentTeamIndex);
            console.log('teams.length:', state.teams.length);
            
            // Vérifier si tous les coureurs de toutes les équipes ont terminé
            // Méthode 1 : On a dépassé la dernière équipe
            if (state.currentTeamIndex >= state.teams.length) {
                console.log('DÉPASSÉ DERNIÈRE ÉQUIPE → FINAUX');
                // Afficher les résultats finaux
                showTeamFinalResults();
                return;
            }
            
            // Méthode 2 : Vérifier si toutes les équipes ont tous leurs coureurs qui ont terminé
            console.log('Vérification allComplete...');
            state.teams.forEach((t, i) => {
                console.log(`Équipe ${i} (${t.name}): completedRunners=${t.completedRunners}, members.length=${t.members.length}, done=${t.completedRunners >= t.members.length}`);
            });
            
            const allComplete = state.teams.every(t => t.completedRunners >= t.members.length);
            
            console.log('allComplete:', allComplete);
            
            if (allComplete) {
                console.log('TOUS TERMINÉS → FINAUX');
                // Afficher les résultats finaux
                showTeamFinalResults();
            } else {
                console.log('PAS TOUS TERMINÉS → INTERMÉDIAIRES');
                // Afficher les résultats intermédiaires
                showTeamIntermediateResults(runner, runnerScore, team);
            }
        }
        
        function showTeamIntermediateResults(runner, score, team) {
            const modal = document.createElement('div');
            modal.className = 'modal';
            
            // Badges individuels
            const sessionData = {
                results: state.results
            };
            const earnedBadges = checkBadges(sessionData);
            let badgesHTML = '';
            if (earnedBadges.length > 0) {
                badgesHTML = '<div style="margin: 20px 0;"><strong>🏆 Badges obtenus :</strong><br>';
                earnedBadges.forEach(badge => {
                    badgesHTML += `<span style="font-size: 2rem; margin: 0 5px;">${badge.icon}</span>`;
                });
                badgesHTML += '</div>';
            }
            
            // Classement actuel
            const sortedTeams = [...state.teams].sort((a, b) => b.totalScore - a.totalScore);
            let rankingHTML = '<div style="margin-top: 20px;"><strong>📊 Classement actuel :</strong></div>';
            sortedTeams.forEach((t, index) => {
                const medal = index === 0 ? '🥇' : index === 1 ? '🥈' : index === 2 ? '🥉' : '';
                rankingHTML += `
                    <div style="padding: 10px; margin: 5px 0; background: rgba(255, 255, 255, 0.05); border-radius: 8px; display: flex; justify-content: space-between;">
                        <span>${medal} ${t.emoji} ${t.name}</span>
                        <span style="font-weight: bold; color: ${t.border};">${t.totalScore} pts</span>
                    </div>
                `;
            });
            
            // Prochain coureur
            const nextRunner = state.currentTeamIndex < state.teams.length ? 
                `${state.teams[state.currentTeamIndex].emoji} ${state.teams[state.currentTeamIndex].members[state.currentRunnerIndex]} (${state.teams[state.currentTeamIndex].name})` 
                : 'Dernier coureur !';
            
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h2>✅ ${runner} a terminé !</h2>
                    </div>
                    
                    <div class="modal-body" style="text-align: center;">
                        <div style="font-size: 3rem; margin: 20px 0;">${team.emoji}</div>
                        
                        <div style="margin: 20px 0;">
                            <div style="font-size: 1.2rem; color: var(--text-dim);">Score personnel</div>
                            <div style="font-size: 3rem; font-weight: 900; color: var(--secondary);">${score} pts</div>
                        </div>
                        
                        ${badgesHTML}
                        
                        <div style="margin: 30px 0; padding: 20px; background: rgba(${team.color}, 0.1); border-radius: 12px; border: 2px solid ${team.border};">
                            <div style="font-size: 1.1rem; margin-bottom: 10px;">Score Équipe ${team.name}</div>
                            <div style="font-size: 2.5rem; font-weight: 900; color: ${team.border};">
                                ${team.totalScore - score} → ${team.totalScore} pts
                            </div>
                            <div style="color: var(--success); font-size: 1.2rem; margin-top: 5px;">+${score} pts</div>
                        </div>
                        
                        ${rankingHTML}
                        
                        <div style="margin-top: 30px; padding: 20px; background: rgba(0, 255, 204, 0.1); border-radius: 12px; border: 2px solid var(--secondary);">
                            <div style="font-size: 1.5rem; font-weight: 700; margin-bottom: 15px;">🏃 Prochain coureur prêt !</div>
                            <div style="font-size: 1.8rem; font-weight: 700; color: var(--secondary);">${nextRunner}</div>
                            <div style="margin-top: 20px; padding: 15px; background: rgba(255, 170, 0, 0.1); border-radius: 8px;">
                                <p style="font-size: 1rem; color: var(--warning); font-weight: 600;">⏱️ Le chronomètre continue de tourner !</p>
                                <p style="font-size: 0.9rem; color: var(--text-dim); margin-top: 5px;">Prépare-toi, c'est à toi dans quelques secondes...</p>
                            </div>
                        </div>
                        
                        <div style="margin-top: 20px;">
                            <div style="font-size: 2rem; font-weight: 900; color: var(--primary);" id="autoPassCountdown">3</div>
                            <div style="color: var(--text-dim); font-size: 0.9rem;">Passage automatique du relais...</div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Compte à rebours de 3 secondes avant passage automatique
            let countdown = 3;
            console.log('Démarrage du compte à rebours:', countdown);
            const countdownInterval = setInterval(() => {
                countdown--;
                console.log('Compte à rebours:', countdown);
                const countdownEl = document.getElementById('autoPassCountdown');
                if (countdownEl) {
                    countdownEl.textContent = countdown;
                } else {
                    console.error('Element autoPassCountdown introuvable !');
                }
                
                if (countdown <= 0) {
                    console.log('Compte à rebours terminé, appel de passRelayAutomatic()');
                    clearInterval(countdownInterval);
                    passRelayAutomatic();
                }
            }, 1000);
        }
        
        function passRelayAutomatic() {
            console.log('=== PASS RELAY AUTOMATIC ===');
            
            // Fermer TOUS les modals (au cas où il y en aurait plusieurs)
            document.querySelectorAll('.modal').forEach(modal => {
                modal.remove();
                console.log('Modal supprimé');
            });
            console.log('Tous les modals fermés');
            
            // Petit délai pour laisser le DOM se mettre à jour
            setTimeout(() => {
                // Réinitialiser l'état pour le prochain coureur (SANS réinitialiser le temps total)
                state.results = [];
                state.currentSequenceIndex = 0;
                state.currentReps = 0;
                state.currentHits = 0;
                
                console.log('État réinitialisé');
                
                // Réinitialiser le Tabata
                state.tabataTime = state.exerciseTime;
                state.tabataRunning = false;
                state.isInWorkPhase = true;
                if (state.tabataInterval) {
                    clearInterval(state.tabataInterval);
                    state.tabataInterval = null;
                }
                
                console.log('Tabata réinitialisé');
                
                // NE PAS réinitialiser totalTime - le chrono continue !
                // state.totalTimeRunning reste true
                
                // Retour à l'écran de session
                document.getElementById('resultsScreen').classList.add('hidden');
                document.getElementById('sessionScreen').classList.remove('hidden');
                
                // IMPORTANT: Afficher sessionInProgress et cacher recapSection
                document.getElementById('recapSection').classList.add('hidden');
                document.getElementById('sessionInProgress').classList.remove('hidden');
                
                console.log('Écrans basculés: resultsScreen hidden, sessionScreen visible, sessionInProgress visible');
                console.log('currentTeamIndex:', state.currentTeamIndex);
                console.log('currentRunnerIndex:', state.currentRunnerIndex);
                console.log('Prochain coureur:', state.teams[state.currentTeamIndex]?.members[state.currentRunnerIndex]);
                
                // Afficher le premier atelier pour le nouveau coureur
                showCurrentAtelier();
                
                console.log('showCurrentAtelier() appelé');
                console.log('Le coureur doit cliquer sur DÉMARRER L\'ÉPREUVE pour commencer');
                console.log('=== FIN PASS RELAY AUTOMATIC ===');
            }, 200); // Délai de 200ms pour laisser le DOM se mettre à jour
        }
        
        function showTeamFinalResults() {
            // Arrêter le chronomètre total
            stopTotalTimer();
            
            // Formater le temps total
            const minutes = Math.floor(state.totalTime / 60);
            const seconds = state.totalTime % 60;
            const totalTimeStr = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            
            // Trier les équipes par score
            const sortedTeams = [...state.teams].sort((a, b) => b.totalScore - a.totalScore);
            
            // Charger tous les résultats de ce match
            const teamMatches = JSON.parse(localStorage.getItem('laserfit-team-matches') || '[]');
            const thisMatch = teamMatches.filter(m => m.matchId === state.teamMatchId);
            
            // Modal des résultats finaux
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.background = 'rgba(0, 0, 0, 0.95)';
            
            // Mode parallèle ou relais
            const isParallel = state.teams.length === 1;
            let modeInfoHTML = '';
            
            if (isParallel) {
                modeInfoHTML = `
                    <div style="margin: 20px 0; padding: 20px; background: rgba(0, 255, 204, 0.1); border: 2px solid var(--secondary); border-radius: 12px; text-align: center;">
                        <div style="font-size: 1.3rem; font-weight: 700; color: var(--secondary); margin-bottom: 10px;">
                            📱 Mode Parallèle - Équipe ${sortedTeams[0].emoji} ${sortedTeams[0].name}
                        </div>
                        <div style="font-size: 0.9rem; color: var(--text-dim);">
                            Cette équipe a couru seule sur cette tablette.<br>
                            Comparez les résultats avec les autres tablettes pour déterminer l'équipe gagnante !
                        </div>
                    </div>
                `;
            }
            
            // Temps total et info
            const timeInfoHTML = `
                <div style="margin: 20px 0; padding: 20px; background: rgba(255, 170, 0, 0.1); border: 2px solid var(--tertiary); border-radius: 12px; text-align: center;">
                    <div style="font-size: 1.2rem; color: var(--text-dim); margin-bottom: 10px;">⏱️ Temps total ${isParallel ? 'de l\'équipe' : 'du relais'}</div>
                    <div style="font-size: 3rem; font-weight: 900; color: var(--tertiary);">${totalTimeStr}</div>
                    <div style="font-size: 0.9rem; color: var(--text-dim); margin-top: 5px;">
                        ${state.teams.reduce((sum, t) => sum + t.members.length, 0)} coureurs • ${state.sequence.length} ateliers chacun
                    </div>
                </div>
            `;
            
            // Podium (seulement si plusieurs équipes)
            let podiumHTML = '';
            if (!isParallel) {
                podiumHTML = '<div class="podium">';
                sortedTeams.slice(0, 3).forEach((team, index) => {
                    const medals = ['🥇', '🥈', '🥉'];
                    const places = ['first', 'second', 'third'];
                    podiumHTML += `
                        <div class="podium-place ${places[index]}">
                            <div class="podium-medal">${medals[index]}</div>
                            <div class="podium-team">${team.emoji} ${team.name}</div>
                            <div class="podium-score">${team.totalScore} pts</div>
                            <div class="podium-block">${index + 1}</div>
                        </div>
                    `;
                });
                podiumHTML += '</div>';
            }
            
            // Détail de l'équipe (gagnante ou unique)
            const winner = sortedTeams[0];
            const winnerResults = thisMatch.filter(m => m.teamId === winner.id);
            const mvp = winnerResults.reduce((best, current) => 
                current.score > best.score ? current : best
            );
            
            const teamTitle = isParallel 
                ? `📊 Détail de l'équipe ${winner.emoji} ${winner.name}`
                : `📊 Détail Équipe ${winner.name} (Gagnante) ${winner.emoji}`;
            
            let detailHTML = `
                <div style="margin: 30px 0; padding: 25px; background: rgba(${winner.color}, 0.1); border: 2px solid ${winner.border}; border-radius: 12px;">
                    <h3 style="color: ${winner.border}; margin-bottom: 20px;">${teamTitle}</h3>
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="font-size: 3rem; font-weight: 900; color: ${winner.border};">${winner.totalScore} pts</div>
                        <div style="font-size: 0.9rem; color: var(--text-dim);">Score total de l'équipe</div>
                    </div>
            `;
            
            winnerResults.forEach(result => {
                const isMVP = result.runnerName === mvp.runnerName;
                detailHTML += `
                    <div style="padding: 10px; margin: 5px 0; background: rgba(255, 255, 255, 0.05); border-radius: 8px; display: flex; justify-content: space-between; align-items: center;">
                        <span>• ${result.runnerName}</span>
                        <span style="font-weight: bold; color: ${winner.border};">${result.score} pts ${isMVP ? '🌟 MVP' : ''}</span>
                    </div>
                `;
            });
            detailHTML += '</div>';
            
            // Badges collectifs
            const teamBadges = checkTeamBadges(winner, winnerResults);
            let teamBadgesHTML = '';
            if (teamBadges.length > 0) {
                teamBadgesHTML = '<div style="margin: 20px 0;"><h3 style="color: var(--secondary); margin-bottom: 15px;">🏆 Badges collectifs obtenus</h3><div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">';
                teamBadges.forEach(badge => {
                    teamBadgesHTML += `
                        <div class="badge-item">
                            <div class="badge-icon">${badge.icon}</div>
                            <div class="badge-name">${badge.name}</div>
                            <div class="badge-desc">${badge.description}</div>
                        </div>
                    `;
                });
                teamBadgesHTML += '</div></div>';
            }
            
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 900px;">
                    <div class="modal-header">
                        <h2>🏆 RÉSULTATS FINAUX</h2>
                        <button class="close-btn" onclick="finishTeamMatch()">✕</button>
                    </div>
                    
                    <div class="modal-body">
                        ${modeInfoHTML}
                        ${timeInfoHTML}
                        ${podiumHTML}
                        ${detailHTML}
                        ${teamBadgesHTML}
                        
                        <div style="margin-top: 30px;">
                            <button class="btn btn-secondary btn-full" onclick="exportTeamResults()">
                                <span>📊 Exporter les résultats CSV</span>
                            </button>
                        </div>
                    </div>
                    
                    <div class="modal-footer">
                        <button class="btn btn-primary btn-full" onclick="finishTeamMatch()">
                            <span>🔄 Nouvelle séance</span>
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
        
        function checkTeamBadges(team, results) {
            const badges = [];
            
            // Force collective (500+ pts)
            if (team.totalScore >= 500) {
                badges.push({
                    icon: '💪',
                    name: 'Force collective',
                    description: '500+ points d\'équipe'
                });
            }
            
            // Équipe d'élite (tous 45+ pts)
            if (results.every(r => r.score >= 45)) {
                badges.push({
                    icon: '🎯',
                    name: 'Équipe d\'élite',
                    description: 'Tous les membres à 45+ pts'
                });
            }
            
            // Cohésion parfaite (écart <10 pts entre min et max)
            const scores = results.map(r => r.score);
            const minScore = Math.min(...scores);
            const maxScore = Math.max(...scores);
            if (maxScore - minScore <= 10) {
                badges.push({
                    icon: '🤝',
                    name: 'Cohésion parfaite',
                    description: 'Scores très homogènes'
                });
            }
            
            // Champions absolus (600+ pts)
            if (team.totalScore >= 600) {
                badges.push({
                    icon: '👑',
                    name: 'Champions absolus',
                    description: '600+ points d\'équipe'
                });
            }
            
            return badges;
        }
        
        function exportTeamResults() {
            const teamMatches = JSON.parse(localStorage.getItem('laserfit-team-matches') || '[]');
            const thisMatch = teamMatches.filter(m => m.matchId === state.teamMatchId);
            
            // Formater le temps total
            const minutes = Math.floor(state.totalTime / 60);
            const seconds = state.totalTime % 60;
            const totalTimeStr = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            
            // Informations de la séance
            const nbEquipes = state.teams.length;
            const nbCoureurs = state.teams.reduce((sum, t) => sum + t.members.length, 0);
            const mode = nbEquipes === 1 ? 'Parallèle (1 équipe par tablette)' : `Relais séquentiel (${nbEquipes} équipes)`;
            
            // En-tête du fichier
            let csv = `LASER FIT - RÉSULTATS MODE ÉQUIPE\n`;
            csv += `Date;${state.sessionDate}\n`;
            csv += `Heure;${state.sessionTime}\n`;
            csv += `Classe;${state.className}\n`;
            csv += `Mode;${mode}\n`;
            csv += `Temps total;${totalTimeStr}\n`;
            csv += `Nombre de coureurs;${nbCoureurs}\n`;
            csv += `Nombre d'ateliers par coureur;${state.sequence.length}\n`;
            csv += `\n`;
            
            // En-têtes CSV pour les détails
            csv += 'Match ID;Date;Heure;Classe;Équipe;Couleur;Coureur;Position;Score;Détails\n';
            
            // Données
            thisMatch.forEach(result => {
                const details = result.results.map(r => 
                    `${r.name}: ${r.reps || r.hits || 0} (${r.totalPoints}pts)`
                ).join(' | ');
                
                csv += `${result.matchId};${result.date};${result.time};${result.className};${result.teamName};${result.teamId};${result.runnerName};${result.runnerIndex + 1};${result.score};"${details}"\n`;
            });
            
            // Totaux par équipe
            csv += '\n\nRÉSUMÉ PAR ÉQUIPE\n';
            csv += 'Rang;Équipe;Score Total;Nombre de coureurs;Moyenne;Écart type\n';
            
            // Trier les équipes par score
            const sortedTeams = [...state.teams].sort((a, b) => b.totalScore - a.totalScore);
            
            sortedTeams.forEach((team, index) => {
                const teamResults = thisMatch.filter(m => m.teamId === team.id);
                const scores = teamResults.map(r => r.score);
                const avg = (team.totalScore / teamResults.length).toFixed(1);
                
                // Calcul de l'écart-type
                const variance = scores.reduce((sum, score) => sum + Math.pow(score - parseFloat(avg), 2), 0) / scores.length;
                const stdDev = Math.sqrt(variance).toFixed(1);
                
                const medals = ['🥇', '🥈', '🥉'];
                const rank = index < 3 ? medals[index] : (index + 1);
                
                csv += `${rank};${team.name};${team.totalScore};${teamResults.length};${avg};${stdDev}\n`;
            });
            
            // MVP
            csv += '\n\nMEILLEUR(E)S COUREUR(SE)S (MVP)\n';
            csv += 'Équipe;Coureur;Score\n';
            sortedTeams.forEach(team => {
                const teamResults = thisMatch.filter(m => m.teamId === team.id);
                if (teamResults.length > 0) {
                    const mvp = teamResults.reduce((best, current) => 
                        current.score > best.score ? current : best
                    );
                    csv += `${team.name};${mvp.runnerName};${mvp.score}\n`;
                }
            });
            
            // Statistiques générales
            csv += '\n\nSTATISTIQUES GÉNÉRALES\n';
            csv += `Temps total du relais;${totalTimeStr}\n`;
            csv += `Temps moyen par coureur;${Math.floor(state.totalTime / nbCoureurs)}s\n`;
            const allScores = thisMatch.map(r => r.score);
            const globalAvg = (allScores.reduce((sum, s) => sum + s, 0) / allScores.length).toFixed(1);
            csv += `Score moyen général;${globalAvg} pts\n`;
            csv += `Score maximum;${Math.max(...allScores)} pts\n`;
            csv += `Score minimum;${Math.min(...allScores)} pts\n`;
            
            // Télécharger
            const BOM = '\uFEFF';
            const blob = new Blob([BOM + csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            const filename = nbEquipes === 1 
                ? `laserfit_team_${state.teams[0].name}_${state.teamMatchId}.csv`
                : `laserfit_team_match_${state.teamMatchId}.csv`;
            link.setAttribute('download', filename);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        
        function finishTeamMatch() {
            document.querySelector('.modal')?.remove();
            resetApp();
        }
        
        function showResults() {
            // Si mode équipe, traiter différemment
            if (state.gameMode === 'team') {
                completeCurrentRunner();
                return;
            }
            
            // Mode solo classique
            document.getElementById('sessionScreen').classList.add('hidden');
            document.getElementById('resultsScreen').classList.remove('hidden');
            
            document.getElementById('resultStudentName').textContent = state.studentName;
            document.getElementById('resultObserverName').textContent = state.observerName;
            document.getElementById('resultClassName').textContent = state.className;
            document.getElementById('resultGroupName').textContent = state.groupName ? ` - ${state.groupName}` : '';
            
            const dateObj = new Date(state.sessionDate + 'T' + state.sessionTime);
            document.getElementById('resultDate').textContent = dateObj.toLocaleDateString('fr-FR', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            }) + ' à ' + state.sessionTime;
            
            const totalScore = state.results.reduce((sum, result) => sum + result.totalPoints, 0);
            const displayTotal = totalScore % 1 === 0 ? totalScore.toFixed(0) : totalScore.toFixed(1);
            document.getElementById('totalScore').textContent = displayTotal;
            
            const detailsDiv = document.getElementById('scoreDetails');
            detailsDiv.innerHTML = '';
            
            state.results.forEach(result => {
                const item = document.createElement('div');
                item.className = 'breakdown-item';
                
                if (result.type === 'exercise') {
                    const displayPoints = result.totalPoints % 1 === 0 ? 
                        result.totalPoints.toFixed(0) : 
                        result.totalPoints.toFixed(1);
                    item.innerHTML = `
                        <div class="breakdown-exercise">${result.name} - ${result.reps} rép.</div>
                        <div class="breakdown-score">${displayPoints} pts</div>
                    `;
                } else {
                    item.innerHTML = `
                        <div class="breakdown-exercise">${result.name} - ${result.hits} tirs</div>
                        <div class="breakdown-score">${result.hits} × ${result.pointsPerHit} = ${result.totalPoints} pts</div>
                    `;
                }
                
                detailsDiv.appendChild(item);
            });
            
            // Créer les données de session pour les badges et le classement
            const sessionData = {
                sessionDate: state.sessionDate,
                sessionTime: state.sessionTime,
                studentName: state.studentName,
                className: state.className,
                groupName: state.groupName,
                results: state.results
            };
            
            // Vérifier et afficher les badges
            const earnedBadges = checkBadges(sessionData);
            displayBadges(earnedBadges);
            
            // Créer le graphique de progression du tir
            setTimeout(() => createShootingProgressChart(state.results), 100);
            
            // Sauvegarder dans le classement
            saveToLeaderboard(sessionData);
        }
        
        // Fonction pour générer et télécharger le CSV
        function downloadCSV() {
            // Construire les en-têtes
            let headers = ['Date', 'Heure', 'Classe', 'Groupe', 'Nom du pratiquant', 'Nom de l\'observateur/coach'];
            
            // Ajouter les colonnes pour chaque exercice
            state.results.forEach((result, index) => {
                const exerciseNum = index + 1;
                headers.push(`Nom exercice ${exerciseNum}`);
                headers.push(`Répétitions/Tirs exercice ${exerciseNum}`);
                headers.push(`Points exercice ${exerciseNum}`);
            });
            headers.push('Total points séance');
            
            // Construire la ligne de données
            let row = [
                state.sessionDate,
                state.sessionTime,
                state.className,
                state.groupName || '',
                state.studentName,
                state.observerName
            ];
            
            // Ajouter les données de chaque exercice
            state.results.forEach(result => {
                row.push(result.name);
                row.push(result.reps || result.hits || 0);
                row.push(result.totalPoints);
            });
            
            // Calculer et ajouter le total
            const totalScore = state.results.reduce((sum, result) => sum + result.totalPoints, 0);
            row.push(totalScore);
            
            // Créer le contenu CSV avec point-virgule (standard Excel français)
            const csvContent = [
                headers.join(';'),
                row.join(';')
            ].join('\n');
            
            // Ajouter le BOM UTF-8 pour Excel
            const BOM = '\uFEFF';
            
            // Télécharger le fichier
            const blob = new Blob([BOM + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `laserfit_${state.studentName.replace(/\s+/g, '_')}_${state.sessionDate}_${state.sessionTime.replace(':', '')}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        
        // Fonction pour générer un QR Code scannable
        function generateQRCode() {
            console.log('🎯 === GÉNÉRATION QR CODE === 🎯');
            console.log('Génération du QR Code démarrée...');
            
            // Générer le CSV complet pour le QR code
            let headers = ['Date', 'Heure', 'Classe', 'Groupe', 'Pratiquant', 'Coach'];
            state.results.forEach((result, index) => {
                headers.push(`Ex${index + 1}`);
                headers.push(`Reps${index + 1}`);
                headers.push(`Pts${index + 1}`);
            });
            headers.push('Total');
            
            let row = [
                state.sessionDate,
                state.sessionTime,
                state.className,
                state.groupName || '',
                state.studentName,
                state.observerName
            ];
            
            state.results.forEach(result => {
                row.push(result.name.replace(/\s+/g, '_'));
                row.push(result.reps || result.hits || 0);
                row.push(result.totalPoints);
            });
            
            const totalScore = state.results.reduce((sum, result) => sum + result.totalPoints, 0);
            row.push(totalScore);
            
            const csvData = headers.join(';') + '\n' + row.join(';');
            
            console.log('📊 Données CSV:', csvData);
            
            const qrContainer = document.getElementById('qrCodeContainer');
            if (!qrContainer) {
                console.error('❌ Container QR Code introuvable (ID: qrCodeContainer)');
                return;
            }
            
            console.log('✅ Container trouvé:', qrContainer);
            
            // Essayer plusieurs APIs de QR code dans l'ordre
            const qrApis = [
                // API 1: QR Server (la plus stable)
                `https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${encodeURIComponent(csvData)}`,
                // API 2: GoQR
                `https://api.qr-code-generator.com/v1/create?access-token=free&qr_code_text=${encodeURIComponent(csvData)}&image_format=PNG&image_width=300`,
                // API 3: QRTag
                `https://qrtag.net/api/qr.png?url=${encodeURIComponent(csvData)}`
            ];
            
            let currentApiIndex = 0;
            
            const tryNextApi = () => {
                if (currentApiIndex >= qrApis.length) {
                    console.error('❌ Toutes les APIs ont échoué');
                    console.log('🔄 Affichage du fallback...');
                    showFallbackQR();
                    return;
                }
                
                const qrUrl = qrApis[currentApiIndex];
                console.log(`🔍 Essai API ${currentApiIndex + 1}:`, qrUrl.substring(0, 50) + '...');
                
                const qrImg = new Image();
                qrImg.crossOrigin = 'anonymous';
                
                qrImg.onload = function() {
                    console.log(`✅ QR code chargé avec succès (API ${currentApiIndex + 1})`);
                    displayQRCode(qrImg);
                };
                
                qrImg.onerror = function(e) {
                    console.warn(`⚠️ API ${currentApiIndex + 1} a échoué, essai suivant...`);
                    currentApiIndex++;
                    setTimeout(tryNextApi, 500);
                };
                
                qrImg.src = qrUrl;
            };
            
            const displayQRCode = (img) => {
                console.log('📱 Affichage du QR Code...');
                qrContainer.innerHTML = `
                    <div style="padding: 20px; background: white; border-radius: 12px; border: 2px solid var(--secondary); max-width: 400px; margin: 0 auto;">
                        <h3 style="color: var(--secondary); margin-top: 0; text-align: center;">📱 QR Code de la séance</h3>
                        
                        <div style="text-align: center; margin: 20px 0;">
                            <img src="${img.src}" style="max-width: 300px; border: 2px solid #ddd; border-radius: 8px; padding: 10px; background: white;" alt="QR Code">
                        </div>
                        
                        <div style="background: rgba(0, 255, 204, 0.1); padding: 15px; border-radius: 8px; margin: 15px 0; color: #1a1a2e;">
                            <div style="font-size: 0.9rem; line-height: 1.6;">
                                <strong style="color: var(--secondary);">📊 Contenu du QR Code :</strong><br>
                                📅 ${state.sessionDate} à ${state.sessionTime}<br>
                                🏫 ${state.className}${state.groupName ? ' - ' + state.groupName : ''}<br>
                                👤 ${state.studentName}<br>
                                🎯 Score : ${totalScore} points<br>
                                📋 + Détails de tous les exercices
                            </div>
                        </div>
                        
                        <div style="margin-top: 15px; padding: 12px; background: rgba(0, 0, 0, 0.05); border-radius: 8px; text-align: center; color: #666; font-size: 0.85rem;">
                            💡 Scannez ce QR code avec votre smartphone pour accéder aux données CSV complètes
                        </div>
                    </div>
                `;
                qrContainer.style.display = 'block';
                console.log('✅ QR Code affiché avec succès');
            };
            
            const showFallbackQR = () => {
                console.log('📋 Affichage du fallback CSV...');
                qrContainer.innerHTML = `
                    <div style="padding: 20px; background: rgba(255, 170, 0, 0.1); border-radius: 12px; border: 2px solid var(--tertiary); max-width: 400px; margin: 0 auto;">
                        <h3 style="color: var(--tertiary); margin-top: 0; text-align: center;">⚠️ QR Code non disponible</h3>
                        
                        <p style="color: #1a1a2e; text-align: center; margin: 15px 0;">
                            La génération du QR code nécessite une connexion internet active.
                        </p>
                        
                        <div style="background: white; padding: 15px; border-radius: 8px; margin: 15px 0;">
                            <strong style="color: var(--secondary);">📋 Données CSV :</strong><br>
                            <textarea readonly style="width: 100%; min-height: 100px; margin-top: 10px; padding: 10px; font-family: monospace; font-size: 0.8rem; border: 1px solid #ddd; border-radius: 4px; resize: vertical; color: #1a1a2e;">${csvData}</textarea>
                        </div>
                        
                        <div style="background: rgba(0, 255, 204, 0.1); padding: 15px; border-radius: 8px; margin: 15px 0; color: #1a1a2e;">
                            <div style="font-size: 0.9rem; line-height: 1.6;">
                                <strong style="color: var(--secondary);">📊 Résumé de la séance :</strong><br>
                                📅 ${state.sessionDate} à ${state.sessionTime}<br>
                                🏫 ${state.className}${state.groupName ? ' - ' + state.groupName : ''}<br>
                                👤 ${state.studentName}<br>
                                🎯 Score : ${totalScore} points
                            </div>
                        </div>
                        
                        <div style="margin-top: 15px; padding: 12px; background: rgba(0, 255, 204, 0.1); border-radius: 8px; text-align: center; color: #1a1a2e; font-size: 0.9rem;">
                            💡 Utilisez le bouton "📊 Télécharger CSV" ci-dessus pour obtenir le fichier complet
                        </div>
                        
                        <button onclick="generateQRCode()" style="width: 100%; margin-top: 15px; padding: 12px; background: var(--secondary); color: #1a1a2e; border: none; border-radius: 8px; font-weight: 700; cursor: pointer; font-size: 1rem;">
                            🔄 Réessayer la génération
                        </button>
                    </div>
                `;
                qrContainer.style.display = 'block';
                console.log('✅ Fallback CSV affiché avec succès');
            };
            
            // Démarrer les essais
            console.log('🚀 Lancement des essais APIs...');
            tryNextApi();
        }
        
        function resetApp() {
            // Cacher et nettoyer le résumé détaillé
            let qrContainer = document.getElementById('qrCodeContainer');
            qrContainer.style.display = 'none';
            qrContainer.innerHTML = '<canvas id="qrCodeCanvas" style="display: none;"></canvas>';
            
            // Réinitialiser l'état
            state = {
                studentName: '',
                observerName: '',
                className: '',
                groupName: '',
                sessionDate: '',
                sessionTime: '',
                exercises: [],
                exerciseTypes: [],
                numExercises: 4,
                numShootingSessions: 1,
                exerciseTime: 45,
                pauseTime: 15,
                sequence: [],
                currentSequenceIndex: 0,
                currentReps: 0,
                currentHits: 0,
                tabataTime: 45,
                tabataRunning: false,
                tabataInterval: null,
                isInWorkPhase: true,
                totalTime: 0,
                totalTimeRunning: false,
                totalTimeInterval: null,
                results: [],
                shootingDistance: 3,
                soundEnabled: true
            };
            
            document.getElementById('resultsScreen').classList.add('hidden');
            document.getElementById('infoScreen').classList.add('hidden');
            document.getElementById('teamSetupScreen').classList.add('hidden');
            document.getElementById('teamRelayScreen').classList.add('hidden');
            document.getElementById('configScreen').classList.add('hidden');
            document.getElementById('sessionScreen').classList.add('hidden');
            document.getElementById('initialModeScreen').classList.remove('hidden');
            
            // Vider les champs de formulaire
            const form = document.getElementById('infoScreen').querySelector('.card');
            if (form) {
                const inputs = form.querySelectorAll('input[type="text"]');
                inputs.forEach(input => {
                    input.value = '';
                    // Supprimer l'historique d'autocomplétion du navigateur
                    input.setAttribute('autocomplete', 'off');
                    input.setAttribute('autocorrect', 'off');
                    input.setAttribute('autocapitalize', 'off');
                    input.setAttribute('spellcheck', 'false');
                });
            }
            
            document.getElementById('studentName').value = '';
            document.getElementById('observerName').value = '';
            document.getElementById('className').value = '';
            document.getElementById('groupName').value = '';
            updateDateTime(); // Réinitialiser date et heure
            document.getElementById('numExercises').value = '4';
            document.getElementById('numShootingSessions').value = '1';
            document.getElementById('exerciseTime').value = '45';
            document.getElementById('pauseTime').value = '15';
            updateExerciseList();
            
            // Nettoyer le cache du formulaire (ne conserve pas l'historique)
            try {
                // Forcer le rechargement sans cache pour les formulaires
                if (window.performance && window.performance.navigation.type === 1) {
                    // Page rechargée
                    const forms = document.querySelectorAll('input');
                    forms.forEach(input => {
                        input.value = '';
                    });
                }
            } catch (e) {
                console.log('Cache clearing not supported');
            }
        }
        
        // CORRIGÉ : DOMContentLoaded unifié (fusion des 2 listeners)
        document.addEventListener('DOMContentLoaded', function() {
            console.log('=== INITIALISATION LASER FIT ===');
            
            // 1. Mettre à jour date/heure
            updateDateTime();
            
            // 2. Vérifier l'écran initial
            const initialScreen = document.getElementById('initialModeScreen');
            if (initialScreen && initialScreen.classList.contains('hidden')) {
                console.warn('⚠️ Écran initial caché - correction');
                initialScreen.classList.remove('hidden');
            }
            
            // 3. Masquer les autres écrans
            const screensToHide = ['infoScreen', 'teamSetupScreen', 'teamRelayScreen', 
                                   'configScreen', 'sessionScreen', 'resultsScreen'];
            screensToHide.forEach(screenId => {
                const screen = document.getElementById(screenId);
                if (screen && !screen.classList.contains('hidden')) {
                    screen.classList.add('hidden');
                }
            });
            
            console.log('✅ Application initialisée');
        });
        
        // Service Worker - Mode offline
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(reg => {
                        console.log('✅ Service Worker enregistré ! Scope:', reg.scope);
                        reg.update(); // Force la mise à jour
                    })
                    .catch(err => console.log('❌ Échec Service Worker:', err));
            });
        }
    </script>
</body>
</html>
